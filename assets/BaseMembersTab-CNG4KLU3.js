import{r as e,b1 as t,b5 as i}from"./index-DZEcYG8Q.js";import{u as n,g as a,S as r,c as s,b as o,aU as l,T as d,s as c,o as m,d as h,t as u,v as x,aG as j}from"./MyApp-DRRa55Bd.js";import p,{getCacheByKey as g}from"./useCacheState-D4ghBCVU.js";import{F as v,e as f}from"./reactions-DA-LA4iH.js";import y from"./ExportButton-CPuYvz9B.js";import b from"./MyTable-D1FbPMwN.js";import{R as k}from"./row-BgRGnxnv.js";import{A as w}from"./index-DhxhS065.js";import{I as S}from"./index-BE0FsmaM.js";import{T as M}from"./index-DOt91uSA.js";import{I as T}from"./index-B87p3I4c.js";import"./useVIP-CGpIDALh.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-BE6G2xp0.js";import"./index-CiDxWY8X.js";import"./Dropdown-BgvXKd3u.js";import"./Input-LTpJ6AuY.js";import"./EyeOutlined-BBPXKIU8.js";import"./SearchOutlined-Bh66KhXc.js";import"./index-KPoWFIyW.js";import"./dropdown-BoVCRztz.js";import"./PurePanel-Beni9Vkb.js";import"./move-Bzyc79vL.js";import"./index-BA5m7QhG.js";import"./Table-DDck-vB7.js";import"./addEventListener-C9VBchln.js";import"./List-BPJoeCz4.js";import"./DownOutlined-BrkIPj-I.js";import"./index-BRk8JeT5.js";import"./index-CEGXIRel.js";import"./index-BQAhaSn9.js";import"./index-D9U4WvIE.js";import"./index-CvALG2oX.js";import"./useBreakpoint-HjQEkdEA.js";import"./Pagination-Dv2YSLQ3.js";import"./index-C0Edlh-n.js";function C({target:h,data:u,onReload:x,onLoadMore:j,loading:g}){const{ti:T}=n(),[C,N]=p("MembersTable.loadMoreCount",10),F=e.useMemo((()=>u.map(((e,t)=>({...e,recent:t+1})))),[u]),I=e.useMemo((()=>{const e=new Set,t=new Map;return u.forEach((i=>{const n=i.bio;e.add(n),t.set(n,(t.get(n)||0)+1)})),Array.from(e).map((e=>({count:t.get(e)||0,text:e,value:e}))).sort(((e,t)=>t.count-e.count)).map((e=>({text:`(${e.count}) ${e.text}`,value:e.text})))}),[u]),L=e.useMemo((()=>{const e=new Set,t=new Map;return u.forEach((i=>{var n;null==(n=i.signals)||n.forEach((i=>{e.add(i.text),t.set(i.text,(t.get(i.text)||0)+1)}))})),Array.from(e).map((e=>({count:t.get(e)||0,text:e,value:e}))).sort(((e,t)=>t.count-e.count)).map((e=>({text:`(${e.count}) ${e.text}`,value:e.text})))}),[u]),$=[{title:"#",dataIndex:"recent",key:"recent",render:(e,t,i)=>t.recent,sorter:(e,t)=>e.recent-t.recent,width:50,fixed:"right"},{title:T({en:"Name",vi:"Tên"}),key:"name",dataIndex:"name",sorter:(e,t)=>e.name.localeCompare(t.name),render:(e,i,n)=>t.jsxs(k,{align:"middle",children:[t.jsx(w,{shape:"square",src:t.jsx(S,{src:i.avatar}),size:50}),t.jsxs(r,{direction:"vertical",style:{marginLeft:"10px"},size:3,children:[t.jsx("a",{href:i.url,target:"_blank",children:t.jsx("b",{children:i.name})}),t.jsx(s.Text,{type:"secondary",children:i.id})]})]}),width:"auto"},{title:T({en:"Verified",vi:"Xác minh"}),dataIndex:"isVerified",key:"isVerified",render:(e,i,n)=>i.isVerified?t.jsx(o,{color:"green",children:t.jsx("i",{className:"fa-solid fa-check"})}):null,filters:[{text:u.filter((e=>e.isVerified)).length+T({en:" verified",vi:" đã xác minh"}),value:!0},{text:u.filter((e=>!e.isVerified)).length+T({en:" unverified",vi:" chưa xác minh"}),value:!1}],onFilter:(e,t)=>t.isVerified==e,width:100},{title:T({en:"Bio",vi:"Bio"}),dataIndex:"bio",key:"bio",sorter:(e,t)=>(e.bio||"").localeCompare(t.bio||""),filters:I,filterSearch:!0,onFilter:(e,t)=>t.bio==e,width:300},{title:T({en:"Signals",vi:"Huy hiệu"}),dataIndex:"signals",key:"signals",render:(e,i,n)=>{var a,r;const s=i.signalCount-((null==(a=i.signals)?void 0:a.length)||0);return t.jsxs(t.Fragment,{children:[null==(r=i.signals)?void 0:r.map((e=>t.jsx(o,{style:{backgroundColor:l(e.type)+"50"},children:e.text},e.type))),s>0&&t.jsx(d,{title:s+T({en:" more signals",vi:" huy hiệu khác"}),children:t.jsxs(o,{color:"blue",children:["+",s]})})]})},filters:L,filterSearch:!0,onFilter:(e,t)=>{var i;return null==(i=t.signals)?void 0:i.some((t=>t.text==e))},width:150},{title:T({en:"Score",vi:"Điểm"}),dataIndex:"score",key:"score",render:(e,t,i)=>a(t.score),sorter:(e,t)=>e.score-t.score,rangeFilter:{getValue:e=>e.score},width:100,align:"right"},{title:T({en:"Joined time",vi:"Tham gia"}),dataIndex:"joinStatus",key:"joinStatus",sorter:(e,t)=>(e.joinStatus||"").localeCompare(t.joinStatus||""),width:300},{title:T({en:"Friend",vi:"Bạn bè"}),dataIndex:"friendshipStatus",key:"friendshipStatus",render:(e,i)=>{const n=f[i.friendshipStatus],a=t.jsx("i",{className:"fa-solid fa-minus",style:{color:"gray"}});if(n){const e=n.icon?t.jsx("i",{className:n.icon}):a;return t.jsx(d,{title:T(n),children:n.color?t.jsx(o,{color:n.color||"default",children:e}):e})}return a},filters:Object.values(v).map((e=>({text:t.jsxs(t.Fragment,{children:[t.jsx(o,{color:f[e].color||"default",children:t.jsx("i",{className:f[e].icon})}),T(f[e])+" ("+u.filter((t=>t.friendshipStatus===e)).length+")"]}),value:e}))),onFilter:(e,t)=>t.friendshipStatus===e,width:100},{title:T({en:"Actions",vi:"Hành động"}),dataIndex:"actions",key:"actions",render:(e,n,a)=>t.jsx(d,{title:T({en:"Member overview",vi:"Tổng quan"}),children:t.jsx(i,{icon:t.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"}),href:"https://fb.com/groups/"+(null==h?void 0:h.id)+"/user/"+n.id,target:"_blank"})}),width:100}];return t.jsx(b,{columns:$,data:F,keyExtractor:e=>e.id,searchable:!0,selectable:!0,renderTitle:()=>t.jsxs(r,{wrap:!0,children:[x&&t.jsx(i,{type:"primary",icon:t.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:x,loading:g,children:T({en:"Reload",vi:"Tải lại"})}),t.jsx(y,{data:u,options:[{key:"json",label:T({en:".json",vi:".json"}),prepareData:e=>({fileName:(null==h?void 0:h.name)+"_"+e.length+"_members.json",data:JSON.stringify(e,null,2)})},{key:"csv",label:T({en:".csv",vi:".csv"}),prepareData:e=>({fileName:(null==h?void 0:h.name)+"_"+e.length+"_members.csv",data:m(e)})}]}),j&&t.jsxs(r.Compact,{children:[t.jsx(d,{title:T({en:"Number of members you want to load more",vi:"Số lượng thành viên muốn tải thêm"}),children:t.jsx(M,{min:10,value:C,onChange:e=>N(e||10)})}),t.jsx(i,{icon:t.jsx("i",{className:"fa-solid fa-play"}),onClick:()=>j(C),loading:g,children:T({en:"Load more",vi:"Tải thêm"})})]})]}),searchPlaceholder:T({en:"Filter members",vi:"Lọc thành viên"}),style:{maxWidth:"100%"},onSearchRow:(e,t)=>{var i;return c(e,t.name+t.id+t.bio+t.joinStatus+(null==(i=t.signals)?void 0:i.map((e=>e.text)).join(",")))}})}function N({type:i,target:a,reloadFunc:r,loadMoreFunc:s,initialData:o,showSearch:l=!1,searchPlaceholder:d}){const{ti:c}=n(),{message:m}=h(),v="BaseMembersTab."+i,[f,y]=p(v+".search."+(null==a?void 0:a.id),""),[b,w]=p(v+".data."+(null==a?void 0:a.id),o||[]),[S,M]=e.useState(!1);e.useEffect((()=>{if(!(null==a?void 0:a.id))return;const e=g(v+".data."+(null==a?void 0:a.id));(null==e?void 0:e.length)||N()}),[null==a?void 0:a.id]);const N=()=>{if(S||!r)return;M(!0);const e=v+".onReload";m.loading({key:e,duration:0,content:c({en:"Loading members...",vi:"Đang tải thành viên..."})}),r(a.id,void 0,f).then((t=>{w(t),m.success({key:e,content:c({en:"Loaded "+t.length+" members",vi:"Tải xong "+t.length+" thành viên"})})})).catch((t=>{m.error({key:e,content:c({en:"Failed to load members",vi:"Tải thành viên thất bại"})+" "+t.message})})).finally((()=>{M(!1)}))};return t.jsxs(k,{gutter:[12,12],justify:"center",children:[l&&t.jsx(T.Search,{placeholder:d||c({en:"Search members by name",vi:"Tìm thành viên theo tên"}),value:f,allowClear:!0,onChange:e=>y(e.target.value),onSearch:()=>{N()},style:{maxWidth:250},enterButton:S?null:t.jsx("i",{className:"fa-solid fa-magnifying-glass"}),loading:S}),t.jsx(C,{target:a,data:b,onReload:r?N:void 0,onLoadMore:s?async(e=10)=>{var i;if(S||!s)return;M(!0);const n=[...b],r=v+".onLoadMore";u(r);let o=0,l=!1;for(m.loading({key:r,duration:0,content:c({en:"Loading more members...",vi:"Đang tải thêm thành viên..."})});o<e;){let d=null==(i=n[n.length-1])?void 0:i.cursor;const h=await s(a.id,d,f);if(!(null==h?void 0:h.length)||l)break;const u=new Set,p=new Set(n.map((e=>e.id)));for(const e of h)p.has(e.id)||(n.push(e),u.add(e.id));if(!u.size)break;if(o+=u.size,m.loading({key:r,duration:0,content:t.jsxs(t.Fragment,{children:[c({en:"Loading more members...",vi:"Đang tải thêm thành viên..."})+`(${o}/${e})`,t.jsx("br",{}),t.jsx("i",{children:c({en:"Click to stop",vi:"Nhấn để dừng"})})]}),onClick:()=>l=!0}),w([...n]),o>=e)break;const g=j(3e3,6e3);await x(g,(e=>(m.loading({key:r+"_wait",duration:0,content:c({en:`Waiting ${Math.round(e/1e3)} seconds...`,vi:`Đang chờ ${Math.round(e/1e3)} giây...`})}),l))),m.destroy(r+"_wait")}m.destroy(r+"_wait"),m.success({key:r,content:c({en:`Loaded ${o}/${e} members`,vi:`Tải xong ${o}/${e} thành viên`})}),M(!1)}:void 0,loading:S})]})}export{N as default};
