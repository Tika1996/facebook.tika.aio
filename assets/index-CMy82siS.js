import{bc as e,r as i,b1 as n,b5 as t,bk as s,bi as r}from"./index-DZEcYG8Q.js";import{d as o}from"./dayjs.min-BxbhFvXw.js";import{d as a,u as l,t as d,v as m,S as c,c as p,f as u,T as h,b as g,s as j,o as x,h as v,aG as f}from"./MyApp-DRRa55Bd.js";import{u as y}from"./useForceStop-tD0KGOJD.js";import k from"./ExportButton-CPuYvz9B.js";import T from"./useCacheState-D4ghBCVU.js";import{getMyManagedGroups as b,UserTypeInGroup as L,getMyJoinedGroups as N,SubspaceType as w,leaveGroup as D}from"./groups-B049n8MW.js";import{getGroupMemberCount as _}from"./groupMembers-DfTdAKN7.js";import{checkVIP as E}from"./useVIP-CGpIDALh.js";import O from"./WordStatisticButton-BogWpezO.js";import{u as M}from"./useAction-DQs_XsxB.js";import{u as C}from"./useDevMode-DFNrRWnS.js";import{S as G}from"./Screen-1_H4V3tg.js";import I from"./MyTable-D1FbPMwN.js";import{A as P}from"./index-DhxhS065.js";import"./index-KPoWFIyW.js";import"./dropdown-BoVCRztz.js";import"./Dropdown-BgvXKd3u.js";import"./PurePanel-Beni9Vkb.js";import"./move-Bzyc79vL.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-BE6G2xp0.js";import"./index-B87p3I4c.js";import"./Input-LTpJ6AuY.js";import"./EyeOutlined-BBPXKIU8.js";import"./SearchOutlined-Bh66KhXc.js";import"./index-CiDxWY8X.js";import"./BadgeWrapper-D8uZ2wKG.js";import"./index-l5dW_dFo.js";import"./index-iP3EwXx5.js";import"./index-DOt91uSA.js";import"./DownOutlined-BrkIPj-I.js";import"./index-BQAhaSn9.js";import"./index-CEGXIRel.js";import"./index-DHhmxYJT.js";import"./col-DLTiGXF3.js";import"./row-BgRGnxnv.js";import"./useBreakpoint-HjQEkdEA.js";import"./index-BA5m7QhG.js";import"./Table-DDck-vB7.js";import"./addEventListener-C9VBchln.js";import"./List-BPJoeCz4.js";import"./index-BRk8JeT5.js";import"./index-D9U4WvIE.js";import"./index-CvALG2oX.js";import"./Pagination-Dv2YSLQ3.js";import"./index-C0Edlh-n.js";function F(){const{message:F,notification:R}=a(),S=e(),{ti:Y}=l(),{onClickAction:$,onClickBulkActions:V}=M(),{devMode:A}=C(),B=y(),[H,J]=T("Groups.data",[]),[W,U]=T("Groups.finished",!1),[q,z]=i.useState(!1),Q=i.useRef(null);i.useEffect((()=>{W||K(!1)}),[]);const K=async(e=!1)=>{var i;if(q&&!e)return;const n=B.start(),t=e?[]:[...H],s=new Set(t.map((e=>e.id))),r="Groups:onReload";d(r),z(!0),U(!1);try{for(const[o,a]of[[b,L.ADMIN],[N,L.MEMBER]]){const l=t[t.length-1];let d=e?"":(null==l?void 0:l.userType)===a?null==l?void 0:l.cursor:"";for(;!n.value();){F.loading({key:r,content:Y({en:"Loading groups...",vi:"Đang tải nhóm..."})+t.length,duration:0});const e=await o({cursor:d}),n=null==e?void 0:e.filter((e=>!s.has(e.id)));if(e.forEach((e=>s.add(e.id))),!(null==n?void 0:n.length))break;t.push(...n),d=null==(i=null==t?void 0:t[(null==t?void 0:t.length)-1])?void 0:i.cursor,J([...t]),await m(1e3)}}F.success({key:r,content:(n.value()?Y({en:"Load groups stopped ",vi:"Dừng tải nhóm "}):Y({en:"Load groups completed ",vi:"Tải xong nhóm "}))+t.length}),U(!n.value())}catch(o){F.error({content:Y({en:"Failed to load groups: ",vi:"Lỗi tải nhóm: "})+o.message})}finally{z(!1)}},X=(e,i=!1)=>$({key:"Groups:onClickLeaveGroup",id:e.id,record:e,actionFn:()=>A?m(1e3):D(e.id),loadingText:e=>Y({en:"Leaving group...",vi:"Đang rời nhóm..."})+e.name,successText:e=>Y({en:"Left group ",vi:"Đã rời nhóm "})+e.name,failedText:e=>Y({en:"Failed to leave group: ",vi:"Lỗi rời nhóm: "})+e.name,onSuccess(){((e,i=L.NOT_JOINED)=>{J((n=>r(n,(n=>{const t=n.findIndex((i=>i.id==e));return n[t].userType=i,n}))))})(e.id)},needConfirm:i,confirmProps:{title:Y({en:"Leave group?",vi:"Rời nhóm?"}),text:e.name}}),Z=e=>{switch(e){case L.MEMBER:return{color:"default",text:Y({en:"Member",vi:"Thành viên"})};case L.ADMIN:return{color:"success",text:"Admin"};case L.NOT_JOINED:return{color:"error",text:Y({en:"Left group",vi:"Đã rời nhóm"})};case L.PENDING:return{color:"warning",text:Y({en:"Pending",vi:"Đang chờ"})};default:return{color:"default",text:"?"}}},ee=[{title:"#",key:"index",dataIndex:"index"},{title:Y({en:"Group",vi:"Nhóm"}),key:"group",dataIndex:"group",sorter:(e,i)=>e.name.localeCompare(i.name),render:(e,i,t)=>n.jsxs(c,{style:{maxWidth:400},align:"start",children:[n.jsx(P,{src:i.avatar,size:45}),n.jsxs(c,{direction:"vertical",size:0,children:[n.jsx(p.Link,{href:i.url,target:"_blank",children:n.jsx("b",{children:i.name})}),n.jsx(p.Text,{type:"secondary",children:i.id})]})]})},{title:Y({en:"Last visit",vi:"Lần xem gần nhất"}),key:"lastVisitedTime",dataIndex:"lastVisitedTime",sorter:(e,i)=>e.lastVisitedTime-i.lastVisitedTime,render:(e,i,n)=>u(i.lastVisitedTime),align:"right"},{title:Y({en:"Type",vi:"Loại"}),key:"type",dataIndex:"userType",render:(e,i,t)=>{const{color:s,text:r}=Z(i.userType);return n.jsxs(n.Fragment,{children:[i.subspaceType==w.TOP_LEVEL_GROUP&&n.jsxs(n.Fragment,{children:[n.jsx(h,{title:Y({en:"Your most interested group",vi:"Nhóm bạn quan tâm nhất"}),children:n.jsx(g,{color:"purple",children:"Top level"})}),n.jsx("br",{})]}),n.jsx(g,{color:s,children:r})]})},filters:[...Object.values(L).map((e=>{const{text:i}=Z(e);return{text:i+" ("+H.filter((i=>i.userType==e)).length+")",value:e}})),{text:"Top level ("+H.filter((e=>e.subspaceType==w.TOP_LEVEL_GROUP)).length+")",value:w.TOP_LEVEL_GROUP}],onFilter:(e,i)=>e==w.TOP_LEVEL_GROUP?i.subspaceType==e:i.userType==e,align:"right"},{title:Y({en:"Action",vi:"Hành động"}),key:"action",render:(e,i,r)=>n.jsxs(c.Compact,{style:{minWidth:30},children:[n.jsx(h,{title:Y({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:n.jsx(t,{type:"default",onClick:()=>(e=>{S("/bulk-downloader",{state:{targetId:e.id,platform:s.Facebook}})})(i),icon:n.jsx("i",{className:"fa-solid fa-download"})})}),i.userType!==L.NOT_JOINED?n.jsx(h,{title:Y({en:"Leave group",vi:"Rời nhóm"}),children:n.jsx(t,{danger:!0,onClick:()=>X(i,!0),icon:n.jsx("i",{className:"fa-regular fa-trash-can"})})}):null]}),align:"right"}];return n.jsx(G,{title:Y({en:"Groups manager",vi:"Quản lý nhóm"}),titleSuffix:n.jsx(g,{style:{marginLeft:"10px",fontWeight:"bold",color:"#888"},children:H.length}),children:n.jsx(I,{ref:Q,data:[...H].sort(((e,i)=>i.subspaceType.localeCompare(e.subspaceType))).map(((e,i)=>({...e,index:i+1}))),columns:ee,renderTitle:e=>{var i,s;const r=(null==e?void 0:e.length)?[...e]:[...H],a=(null==(i=null==r?void 0:r.map((e=>H.find((i=>i.id===e.id)))))?void 0:i.filter((e=>e&&e.userType!==L.NOT_JOINED)))||[],l=(null==(s=null==r?void 0:r.map((e=>H.find((i=>i.id===e.id)))))?void 0:s.filter((e=>e&&e.userType!==L.ADMIN&&e.userType!==L.PENDING)))||[];return n.jsxs(n.Fragment,{children:[n.jsx(t,{type:"primary",icon:q?n.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):n.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>K(!0),children:Y({en:"Reload",vi:"Tải lại"})}),n.jsx(k,{data:r,options:[{key:"id",label:".txt (group id)",prepareData:e=>({fileName:"your_groups_id"+o().format("YYYY-MM-DD-HHmmss")+".txt",data:null==e?void 0:e.map((e=>e.id)).join("\n")})},{key:"id_name",label:".csv (id+name)",prepareData:e=>({fileName:"my_joined_groups_id_name.csv",data:x(e.map((e=>({uid:e.id,name:e.name}))))})},{key:"json",label:".json",prepareData:e=>({fileName:"your_groups"+o().format("YYYY-MM-DD-HHmmss")+".json",data:JSON.stringify(null==e?void 0:e.map((e=>({...e,last_visited:u(e.lastVisitedTime)}))),null,4)})},{key:"csv",label:".csv",prepareData:e=>({fileName:"your_groups"+o().format("YYYY-MM-DD-HHmmss")+".csv",data:x(e)})}]}),n.jsx(h,{title:Y({en:`Leave ${a.length} selected groups`,vi:`Rời ${a.length} nhóm được chọn`}),children:n.jsx(t,{danger:!0,disabled:a.length<=0,icon:n.jsx("i",{className:"fa-regular fa-trash-can"}),onClick:()=>{return V({data:e=a,key:"Groups:onClickLeaveSelectedGroups",actionFn:X,loadingText:(e,i,n)=>Y({en:"Leaving groups...",vi:"Đang rời nhóm..."}),successText:(e,i)=>Y({en:"Bulk leave groups completed",vi:"Hoàn tất Rời nhóm hàng loạt"}),successDescItem:e=>n.jsx("a",{target:"_blank",href:v(e.id),children:e.name}),confirmProps:{title:Y({en:`Leave ${e.length} groups`,vi:`Rời ${e.length} nhóm`}),text:Y({en:`Are your sure want to Leave ${e.length} groups?`,vi:`Bản có chãc muốn rời ${e.length} nhóm?`})}});var e},children:a.length})}),n.jsx(h,{title:Y({en:`Find groups that have no admin in ${l.length} selected groups`,vi:`Tìm nhóm không có admin quản lý trong ${l.length} nhóm được chọn`}),children:n.jsx(t,{icon:n.jsx("i",{className:"fa-solid fa-user-large-slash"}),onClick:()=>(async e=>{var i,t;if(!(await E()))return;const s="Groups:onClickFindNoAdminGroups",r=s+":waiting";d(s),F.loading({key:s,duration:0,content:Y({en:"Finding groups no admin... ",vi:"Đang tìm nhóm không có admin... "})});let o=[],a=!1;for(let l=0;l<e.length&&!a;l++){const d=e[l],c={key:s,duration:0,content:n.jsxs(n.Fragment,{children:[Y({en:"Checking group... ",vi:"Đang kiểm tra... "})+`${l+1}/${e.length}`,n.jsx("br",{}),d.name,n.jsx("br",{}),Y({en:"Found ",vi:"Tìm thấy "})+o.length,n.jsx("br",{}),n.jsx("i",{children:Y({en:"Click to stop",vi:"Bấm để dừng"})})]}),onClick:()=>{a=!0}};if(F.loading(c),0===(await _(d.id)).adminCount&&(o.push(d),null==(t=null==(i=Q.current)?void 0:i.setDataSelected)||t.call(i,[...o])),F.success(c),l<e.length-1){const e=f(2e3,5e3);await m(e,(e=>(F.loading({key:r,content:Y({en:"Waiting "+Math.round(e/1e3)+"s",vi:"Đang đợi "+Math.round(e/1e3)+"s"}),duration:0}),a)))}}F.destroy(s),F.destroy(r),R.open({type:"success",duration:0,message:Y({en:`Found ${o.length}/${e.length} groups no admin`,vi:`Tìm thấy ${o.length}/${e.length} nhóm không có admin`}),description:n.jsx("ol",{style:{maxHeight:300,overflowY:"auto",whiteSpace:"pre-wrap"},children:o.map((e=>n.jsx("li",{children:n.jsx("a",{target:"_blank",href:v(e.id),children:e.name})},e.id)))})})})(l),disabled:l.length<=0,children:l.length})}),n.jsx(O,{name:"Groups",text:H.map((e=>e.name)).join(" ")}),n.jsx(h,{title:Y({en:"View on Facebook",vi:"Xem trên Facebook"}),children:n.jsx(t,{icon:n.jsx("i",{className:"fa-solid fa-external-link"}),onClick:()=>window.open("https://www.facebook.com/groups/joins","_blank")})})]})},size:"small",searchable:!0,selectable:!0,onSearchRow:(e,i)=>j(e,(null==i?void 0:i.name)+(null==i?void 0:i.id)+u(null==i?void 0:i.lastVisitedTime)),keyExtractor:e=>e.id})})}export{F as default};
