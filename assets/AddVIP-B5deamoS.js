import{r as e,a_ as t,b1 as a,b5 as r}from"./index-DZEcYG8Q.js";import{d as i,s as n,S as s,i as l,c as o,h as d,e as c,b as u,T as m,f,p as x,j}from"./MyApp-DRRa55Bd.js";import p from"./ProfileCard-78JF4fiM.js";import{getUidFromUrl as h}from"./getIds-BE6G2xp0.js";import{d as v}from"./dayjs.min-BxbhFvXw.js";import g from"./MyTable-D1FbPMwN.js";import{I as y}from"./index-BE0FsmaM.js";import{C as w}from"./index-B2BHea4N.js";import{I as C}from"./index-B87p3I4c.js";import{D as I}from"./index-B0BghIXV.js";import"./index-BA5m7QhG.js";import"./index-DOt91uSA.js";import"./DownOutlined-BrkIPj-I.js";import"./Table-DDck-vB7.js";import"./addEventListener-C9VBchln.js";import"./List-BPJoeCz4.js";import"./index-BRk8JeT5.js";import"./index-CEGXIRel.js";import"./index-BQAhaSn9.js";import"./index-KPoWFIyW.js";import"./dropdown-BoVCRztz.js";import"./Dropdown-BgvXKd3u.js";import"./PurePanel-Beni9Vkb.js";import"./move-Bzyc79vL.js";import"./index-D9U4WvIE.js";import"./index-CvALG2oX.js";import"./SearchOutlined-Bh66KhXc.js";import"./useBreakpoint-HjQEkdEA.js";import"./Pagination-Dv2YSLQ3.js";import"./Input-LTpJ6AuY.js";import"./row-BgRGnxnv.js";import"./EyeOutlined-BBPXKIU8.js";import"./index-CiDxWY8X.js";const k="fbaio-dev-pass";function S(){const{message:S}=i(),[b,P]=e.useState(""),[T,D]=e.useState(!1),[N,R]=e.useState(null),[L,E]=e.useState(""),[V,U]=e.useState(""),[M,$]=e.useState(v().add(3,"day")),[O,A]=e.useState(""),[F,B]=e.useState(localStorage.getItem(k)||""),[Y,_]=e.useState({}),[q,z]=e.useState(!1),[W,K]=e.useState([]),Q=e.useRef(null);e.useEffect((()=>{localStorage.setItem(k,F)}),[F]),e.useEffect((()=>{localStorage.getItem(k)&&J()}),[]);const G=e.useMemo((()=>{const e=W.filter((e=>{var t;return null==(t=e.name)?void 0:t.startsWith("referral from ")}));return W.map((t=>({...t,profile:Y[t.uid],referralCount:e.filter((e=>e.name=="referral from "+t.uid)).length})))}),[W,Y]),H=async e=>{if(e){D(!0);try{const t=await h(e);if(!t)throw new Error("Cannot get UID from URL");const a=await j(t);if(!a)throw new Error("Cannot get profile from UID: "+t);R(a),E(t),U(a.name)}catch(t){S.error(t.message)}finally{D(!1)}}},J=async()=>{const e="onPressLoad";S.loading({key:e,content:"Loading...",duration:0}),z(!0);try{const a=await fetch(t.FB_AIO.server+"/allVIP?password="+F),r=await a.json(),i=(new Date).getTime(),n=r.map(((e,t)=>{const a=parseInt(null==e?void 0:e[1]);return{index:t+1,uid:null==e?void 0:e[0],time:a,inVIP:a>i,name:null==e?void 0:e[2],referralCount:0}})).filter((e=>e.uid)).reverse();console.log(n),K(n),S.success({key:e,content:"Load success"})}catch(a){S.error({key:e,content:a.message})}finally{z(!1)}},X=[{title:"#",dataIndex:"index",key:"index",sorter:(e,t)=>e.index-t.index,width:80},{title:"User",dataIndex:"uid",key:"uid",render:(e,t,r)=>a.jsxs(s,{children:[a.jsx(y,{src:l(t.uid,50),width:50,height:50,preview:{src:l(t.uid)}}),a.jsxs(s,{size:0,direction:"vertical",children:[a.jsx(o.Link,{href:d(t.uid),target:"_blank",strong:!0,children:a.jsx("b",{children:t.name})}),t.profile&&a.jsxs(o.Text,{children:["(",t.profile.name,")"]}),a.jsx(o.Text,{type:"secondary",children:t.uid})]})]}),filters:[{text:`Người chia sẻ (${W.filter((e=>{var t;return null==(t=e.name)?void 0:t.includes("referral of")})).length})`,value:"referral of"},{text:`Người được chia sẻ (${W.filter((e=>{var t;return null==(t=e.name)?void 0:t.includes("referral from")})).length})`,value:"referral from"},{text:`review (${W.filter((e=>{var t;return null==(t=e.name)?void 0:t.includes("review")})).length})`,value:"review"}],onFilter:(e,t)=>n(e,t.name)},{title:"Expire time",dataIndex:"inVIP",key:"inVIP",render:(e,t,r)=>{const i=new Date(parseInt(t.time)),n=c(i.getTime());return a.jsxs(s,{direction:"vertical",children:[a.jsx(u,{color:t.inVIP?"success":"error",children:a.jsxs(o.Text,{children:[t.inVIP?"":"-",n]})}),a.jsxs(o.Text,{type:"secondary",children:[t.time," - ",i.toLocaleString()]})]})},filters:[{text:`✅ ${W.filter((e=>e.inVIP)).length}`,value:!0},{text:`❌ ${W.filter((e=>!e.inVIP)).length}`,value:!1}],onFilter:(e,t)=>t.inVIP===e,sorter:(e,t)=>(parseInt(e.time)||0)-(parseInt(t.time)||0)},{title:"Ref count",dataIndex:"referralCount",key:"referralCount",sorter:(e,t)=>e.referralCount-t.referralCount,width:100},{title:"Action",dataIndex:"action",key:"action",render:(e,t,i)=>a.jsxs(s.Compact,{children:[a.jsx(m,{title:"Update",children:a.jsx(r,{icon:a.jsx("i",{className:"fa-solid fa-pen"}),onClick:()=>(e=>{P(e.uid),H(e.uid),$(v(Number(e.time)))})(t)})}),t.referralCount>0&&a.jsx(m,{title:"Show ref",children:a.jsx(r,{icon:a.jsx("i",{className:"fa-solid fa-users"}),onClick:()=>(e=>{var t;null==(t=Q.current)||t.setSearch(e.uid)})(t)})}),!t.profile&&a.jsx(m,{title:"Reveal",children:a.jsx(r,{icon:a.jsx("i",{className:"fa-solid fa-eye"}),onClick:()=>(async e=>{const t="onPressReveal:"+e.uid;S.loading({key:t,content:"Revealing... "+e.name,duration:0});try{const a=await j(e.uid);if(!a)throw new Error("Cannot reveal: "+e.name);_((t=>({...t,[e.uid]:a}))),S.success({key:t,content:"Revealed: "+a.name})}catch(a){S.error({key:t,content:"Cannot reveal: "+e.name})}})(t)})})]})}],Z=W.find((e=>e.uid==L));return a.jsxs("div",{children:[a.jsx("h1",{children:"Dev"}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[a.jsx(w,{style:{maxWidth:400},children:a.jsxs(s,{direction:"vertical",children:[a.jsx(C.Search,{value:b,onChange:e=>{const t=e.target.value;P(t),H(t)},onSearch:H,placeholder:"Enter FB URL",prefix:a.jsx("i",{className:"fa-brands fa-facebook"}),loading:T}),N&&a.jsx(p,{about:N,onClose:()=>{R(null)}}),a.jsx(C,{value:L,onChange:e=>E(e.target.value),placeholder:"UID",prefix:a.jsx("i",{className:"fa-solid fa-hashtag"}),allowClear:!0}),Z&&a.jsx(o.Text,{type:"secondary",children:Z.name}),a.jsx(C,{value:V,onChange:e=>U(e.target.value),placeholder:"NAME",prefix:a.jsx("i",{className:"fa-solid fa-user"}),allowClear:!0}),Z&&a.jsxs(o.Text,{type:"secondary",children:[f(Z.time)," (",Z.time<M.toDate().getTime()?"ít hơn ":"nhiều hơn ",x(Math.abs(Z.time-M.toDate().getTime())),")"]}),a.jsxs(s.Compact,{children:[a.jsx(I,{defaultValue:v(),format:"YYYY-MM-DD",value:M,onChange:$,prefix:a.jsx("i",{className:"fa-regular fa-calendar"}),allowClear:!1}),[{value:5,label:"5d"},{value:30,label:"1m"},{value:Math.floor(182.5),label:"6m"},{value:365,label:"1y"}].map((({value:e,label:t})=>a.jsx(r,{onClick:()=>{$(v().add(e,"day"))},children:t},e)))]}),a.jsxs(s.Compact,{children:[a.jsx(C,{value:O,onChange:e=>A(e.target.value),placeholder:"Reason",prefix:a.jsx("i",{className:"fa-solid fa-question"}),allowClear:!0}),["review","phunt","65k","3$"].map((e=>a.jsx(r,{style:{paddingLeft:5,paddingRight:5},onClick:()=>{A(e)},children:e},e)))]}),a.jsx(C.Password,{placeholder:"Password",onChange:e=>B(e.target.value),value:F,prefix:a.jsx("i",{className:"fa-solid fa-lock"}),allowClear:!0}),a.jsx(s,{style:{width:"100%",justifyContent:"flex-end"},children:a.jsx(r,{type:"primary",onClick:async()=>{const e="submit";S.loading({key:e,content:"Submitting...",duration:0});try{const a={uid:L,name:V+(O?` (${O})`:""),expireTime:M.toDate().getTime()+"",password:F},r=await fetch(t.FB_AIO.server+"/addVIP?"+new URLSearchParams(a)),i=await r.text();console.log(i),S.info({key:e,content:i})}catch(a){S.error({key:e,content:a.message})}},disabled:!V||!L||!F,children:"Submit"})})]})}),a.jsx("hr",{}),a.jsx(g,{ref:Q,columns:X,data:G,searchable:!0,virtual:!0,pageSize:5,keyExtractor:e=>""+(null==e?void 0:e.uid),onSearchRow:(e,t)=>{var a;return n(e,(null==t?void 0:t.name)+(null==t?void 0:t.uid)+(null==(a=null==t?void 0:t.profile)?void 0:a.name))},renderTitle:()=>a.jsx(r,{onClick:J,disabled:!F,loading:q,icon:a.jsx("i",{className:"fa-solid fa-sync"}),children:"Reload"})})]})]})}export{S as default};
