import{y as l,x as n,W as o,az as i,w as e}from"./MyApp-DRRa55Bd.js";import"./index-DZEcYG8Q.js";async function d(e=""){const d=await l({fb_api_req_friendly_name:"StoriesTrayRectangularQuery",variables:{blur:10,bucketsToFetch:5,cursor:e,scale:1,id:await o()},doc_id:"24539171939059864"}),u=n(d);console.log(u);const{edges:r=[],page_info:t={}}=i(u);return r.map((l=>{var n,o,i,e,d,u,r,a,v,s,_,c,m;const y=(null==(n=null==l?void 0:l.node)?void 0:n.story_bucket_owner)||{};return{bucket_id:null==(o=null==l?void 0:l.node)?void 0:o.id,thumbnail:null==(u=null==(d=null==(e=null==(i=null==l?void 0:l.node)?void 0:i.thumbnail_story_to_show)?void 0:e.story_card_info)?void 0:d.story_thumbnail)?void 0:u.uri,owner:{id:y.id,name:y.name,avatar:(null==(r=y.coverImage)?void 0:r.uri)||(null==(a=y.profilePic)?void 0:a.uri)||(null==(v=y.profile_picture)?void 0:v.uri)},stories:null==(c=null==(_=null==(s=null==l?void 0:l.node)?void 0:s.unified_stories)?void 0:_.edges)?void 0:c.map((l=>{var n,o;return{id:null==(n=null==l?void 0:l.node)?void 0:n.id,expiration_time:null==(o=null==l?void 0:l.node)?void 0:o.expiration_time}})),seen:null==(m=null==l?void 0:l.node)?void 0:m.is_bucket_seen_by_viewer,cursor:(null==l?void 0:l.cursor)||t.end_cursor}})).filter((l=>l.stories.length>0))}async function u(o=""){var i,e,d,u,r;const t=await l({fb_api_req_friendly_name:"StoriesSuspenseContentPaneRootWithEntryPointQuery",variables:{blur:10,bucketID:o,feedbackSource:65,feedLocation:"COMET_MEDIA_VIEWER",focusCommentID:null,initialBucketID:o,initialLoad:!1,scale:1,shouldDeferLoad:!1,shouldEnableArmadilloStoryReply:!0,shouldEnableLiveInStories:!0,__relay_internal__pv__StoriesIsShareToStoryEnabledrelayprovider:!1,__relay_internal__pv__StoriesLWRVariantrelayprovider:"www_new_reactions"},doc_id:"8237681579610775"}),a=n((null==t?void 0:t.split("\n")[0])||"{}");console.log(a);const v=(null==(e=null==(i=null==a?void 0:a.data)?void 0:i.nodes)?void 0:e[0])||(null==(d=null==a?void 0:a.data)?void 0:d.bucket);return null==(r=null==(u=null==v?void 0:v.unified_stories)?void 0:u.edges)?void 0:r.map((l=>{var n,i,e,d,u,r,t,a,v,s,_,c,m,y,f,g,b,p,w,h,S,I,k,C,E,D,A,L,T,M,V,R,q,x,P,W,Q,j,G,O,F;const H=(null==(d=null==(e=null==(i=null==(n=null==l?void 0:l.node)?void 0:n.attachments)?void 0:i.sort(((l,n)=>{var o,i,e,d,u,r,t,a;return((null==(i=null==(o=null==n?void 0:n.media)?void 0:o.image)?void 0:i.width)||0)*((null==(d=null==(e=null==n?void 0:n.media)?void 0:e.image)?void 0:d.height)||0)-((null==(r=null==(u=null==l?void 0:l.media)?void 0:u.image)?void 0:r.width)||0)*((null==(a=null==(t=null==l?void 0:l.media)?void 0:t.image)?void 0:a.height)||0)})))?void 0:e[0])?void 0:d.media)||{},z=(null==(r=null==(u=null==l?void 0:l.node)?void 0:u.story_card_info)?void 0:r.feedback_summary)||{},B=[];for(let o of(null==(v=null==(a=null==(t=null==l?void 0:l.node)?void 0:t.story_card_info)?void 0:a.viewerList_viewers)?void 0:v.edges)||[])for(let l of(null==(s=null==o?void 0:o.feedback)?void 0:s.lightweight_reactions)||[]){let n=null==(c=null==(_=null==l?void 0:l.id)?void 0:_.split(":"))?void 0:c[0],o="";for(let i of(null==(m=null==l?void 0:l.last5)?void 0:m.edges)||[])o+=null==(y=null==i?void 0:i.node)?void 0:y.reaction;B.push({uid:n,reaction:o})}return{bucket_id:o,id:null==(f=null==l?void 0:l.node)?void 0:f.id,caption:(null==(b=null==(g=null==l?void 0:l.node)?void 0:g.message)?void 0:b.text)||(null==(p=null==H?void 0:H.message)?void 0:p.text)||(null==(w=null==H?void 0:H.title)?void 0:w.text),thumbnail:(null==(I=null==(S=null==(h=null==l?void 0:l.node)?void 0:h.story_card_info)?void 0:S.story_video_thumbnail)?void 0:I.uri)||(null==(E=null==(C=null==(k=null==l?void 0:l.node)?void 0:k.story_card_info)?void 0:C.story_thumbnail)?void 0:E.uri)||(null==(D=null==H?void 0:H.previewImage)?void 0:D.uri),url:null==(L=null==(A=null==l?void 0:l.node)?void 0:A.shareable)?void 0:L.url,video:(null==H?void 0:H.playable_url_quality_hd)||(null==H?void 0:H.browser_native_hd_url)||(null==H?void 0:H.playable_url)||(null==H?void 0:H.browser_native_sd_url),image:(null==(T=null==H?void 0:H.image)?void 0:T.uri)||(null==(M=null==H?void 0:H.previewImage)?void 0:M.uri),reaction:null==(R=null==(V=null==z?void 0:z.reaction_summary)?void 0:V.map((l=>l.reaction_unicode)))?void 0:R.join(""),react_count:null==z?void 0:z.total_reaction_count,view_count:(null==(P=null==(x=null==(q=null==l?void 0:l.node)?void 0:q.story_card_info)?void 0:x.story_viewers)?void 0:P.count)||(null==(j=null==(Q=null==(W=null==l?void 0:l.node)?void 0:W.story_card_info)?void 0:Q.viewers)?void 0:j.count),creation_time:1e3*((null==(G=null==l?void 0:l.node)?void 0:G.creation_time)||0),seen:null==(F=null==(O=null==l?void 0:l.node)?void 0:O.story_card_seen_state)?void 0:F.is_seen_by_viewer,reactions:B}}))}async function r(e=""){const d=await l({fb_api_req_friendly_name:"CometActivityLogStoriesArchiveRendererPaginationQuery",variables:{cursor:e,count:10,scale:1,id:btoa("story_archive"+await o()+":1883182675091806")},doc_id:"4877899912263112"}),u=n(d);console.log(u);const{edges:r=[],page_info:t={}}=i(u);return r.map((l=>{var n,o,i,e,d,u;const r=(null==(n=null==l?void 0:l.node)?void 0:n.node)||(null==l?void 0:l.node);return{id:null==r?void 0:r.id,creation_time:null==(o=null==r?void 0:r.story_card_info)?void 0:o.local_creation_time,thumbnail:null==(e=null==(i=null==r?void 0:r.story_card_info)?void 0:i.story_thumbnail)?void 0:e.uri,seen_count:null==(u=null==(d=null==r?void 0:r.story_card_seen_state)?void 0:d.seen_count)?void 0:u.count,cursor:(null==l?void 0:l.cursor)||t.end_cursor}}))}async function t({afterTime:o="",beforeTime:i="",creationTime:d=""}={}){var u,r,t,v;if(d){const l=new Date(d),n=new Date(l.getTime()+864e5);o=e(l),i=e(n)}console.log(o,i);const s=await l({fb_api_req_friendly_name:"StoriesArchiveContentPaneRootQuery",variables:{lower_bound_time:o,upper_bound_time:i,scale:1,blur:null,shouldEnableLiveInStories:!0,feedbackSource:65,useDefaultActor:!1,feedLocation:"COMET_MEDIA_VIEWER",focusCommentID:null,isStoriesArchive:!0,__relay_internal__pv__StoriesIsShareToStoryEnabledrelayprovider:!1},doc_id:"8266171723403755"}),_=n(s.split("\n")[0]||"{}");console.log(_);const{edges:c=[],page_info:m={}}=(null==(v=null==(t=null==(r=null==(u=null==_?void 0:_.data)?void 0:u.viewer)?void 0:r.stories_data)?void 0:t.story_archive)?void 0:v.cards)||{};return c.map((l=>{var n,o,i,e,d,u,r,t,v,s,_,c,m,y,f,g,b,p,w,h,S,I;const k=(null==(n=null==l?void 0:l.node)?void 0:n.viewerCount)||{},C=null==(i=null==(o=null==l?void 0:l.node)?void 0:o.media_attribution_elements)?void 0:i.find((l=>"MUSIC"===l.attribution_type));function E(n){var o,i;return null==(i=null==(o=null==l?void 0:l.node)?void 0:o.attachments)?void 0:i.find((l=>{var o;return(null==(o=null==l?void 0:l.media)?void 0:o.__typename)===n}))}function D(l){return["image","previewImage","blurred_image"].reduce(((n,o)=>{var i,e;return n||(null==(e=null==(i=null==l?void 0:l.media)?void 0:i[o])?void 0:e.uri)}),"")}let A="",L=E("GenericAttachmentMedia");return L?A=E("Photo"):L=E("Photo"),{id:null==(e=null==l?void 0:l.node)?void 0:e.id,created_at:1e3*((null==(d=null==l?void 0:l.node)?void 0:d.creation_time)||0),last_seen_at:1e3*((null==(r=null==(u=null==l?void 0:l.node)?void 0:u.story_card_seen_state)?void 0:r.seen_receipts_last_seen_time)||0),comment_count:null==(v=null==(t=null==l?void 0:l.node)?void 0:t.feedback)?void 0:v.story_comment_count,viewer_count:{friend:null==(s=null==k?void 0:k.friendViewerCount)?void 0:s.count,connection:null==(_=null==k?void 0:k.connectionViewerCount)?void 0:_.count,follower:null==(c=null==k?void 0:k.followerViewerCount)?void 0:c.count,new_friend:null==(m=null==k?void 0:k.newFriendViewerCount)?void 0:m.count,new_connection:null==(y=null==k?void 0:k.newConnectionViewerCount)?void 0:y.count},image:D(L),image_background:D(A),video:["browser_native_hd_url","browser_native_sd_url"].reduce(((n,o)=>{var i,e,d,u;return n||(null==(u=null==(d=null==(e=null==(i=null==l?void 0:l.node)?void 0:i.attachments)?void 0:e.find((l=>{var n;return null==(n=null==l?void 0:l.media)?void 0:n[o]})))?void 0:d.media)?void 0:u[o])}),""),music:C?(null==C?void 0:C.song_title)+" - "+(null==C?void 0:C.artist_name):"",reactions:null==(p=null==(b=null==(g=null==(f=null==l?void 0:l.node)?void 0:f.story_card_info)?void 0:g.story_card_reactions)?void 0:b.edges)?void 0:p.map((l=>{var n,o,i,e,d,u,r;return{uid:null==(o=null==(n=null==l?void 0:l.node)?void 0:n.messaging_actor)?void 0:o.id,reactions:null==(d=null==(e=null==(i=null==l?void 0:l.node)?void 0:i.messaging_actions)?void 0:e.edges)?void 0:d.reduce(((l,n)=>{var o;return l+(null==(o=null==n?void 0:n.node)?void 0:o.reaction)}),""),count:null==(r=null==(u=null==l?void 0:l.node)?void 0:u.messaging_actions)?void 0:r.count}})),viewers:null==(I=null==(S=null==(h=null==(w=null==l?void 0:l.node)?void 0:w.story_card_info)?void 0:h.viewerList_viewers)?void 0:S.edges)?void 0:I.map(a)}}))}function a(l){var n,o,i,e,d,u,r,t;return{uid:null==(n=null==l?void 0:l.node)?void 0:n.id,avatar:null==(i=null==(o=null==l?void 0:l.node)?void 0:o.profile_picture)?void 0:i.uri,name:null==(e=null==l?void 0:l.node)?void 0:e.name,reactions:null==(u=null==(d=null==l?void 0:l.feedback)?void 0:d.lightweight_reactions)?void 0:u.reduce(((l,n)=>{var o,i;const e=(null==(o=null==n?void 0:n.last5)?void 0:o.edges)||(null==(i=null==n?void 0:n.messaging_actions)?void 0:i.edges);return l+(null==e?void 0:e.reduce(((l,n)=>{var o;return l+(null==(o=null==n?void 0:n.node)?void 0:o.reaction)}),""))}),""),count:null==(t=null==(r=null==l?void 0:l.feedback)?void 0:r.lightweight_reactions)?void 0:t.reduce(((l,n)=>{var o;return l+(null==(o=null==n?void 0:n.messaging_actions)?void 0:o.count)}),0),seen_time:1e3*((null==l?void 0:l.seen_time)||0),cursor:null==l?void 0:l.cursor}}async function v({storyId:o="",cursor:e=""}={}){const d=await l({fb_api_req_friendly_name:"StoriesViewerSheetViewerListContentQuery",variables:{cursor:e,id:o,viewerCount:8},doc_id:"3934951263269875"}),u=n(d.split("\n")[0]||"{}");console.log(u);const{edges:r=[],page_info:t={}}=i(u);return r.map(a)}async function s(o=""){var i,e,d,u,r;const t=await l({variables:{scale:1,userID:o,useIncrementalDelivery:!0},doc_id:"4192155837522535"}),a=n(t.split("\n")[0]||"{}"),v=null==(u=null==(d=null==(e=null==(i=null==a?void 0:a.data)?void 0:i.user)?void 0:e.story_bucket)?void 0:d.nodes)?void 0:u[0];return console.log(a),{bucketId:null==v?void 0:v.id,firstStoryId:null==(r=null==v?void 0:v.first_story_to_show)?void 0:r.id}}async function _(o="",i=""){var e,d,u,r,t,a;const v=await l({fb_api_req_friendly_name:"useStoriesSendReplyMutation",variables:{input:{lightweight_reaction_actions:{offsets:[0],reaction:i},story_id:o,story_reply_type:"LIGHT_WEIGHT",actor_id:"me"}},doc_id:"3769885849805751"}),s=n(v);return console.log(s),null==(a=null==(t=null==(r=null==(u=null==(d=null==(e=null==s?void 0:s.data)?void 0:e.direct_message_reply)?void 0:d.story)?void 0:u.story_card_info)?void 0:r.story_card_reactions)?void 0:t.edges)?void 0:a.length}async function c(i=""){var e,d;const u=await l({fb_api_req_friendly_name:"StoriesArchiveDeleteCardOptionMenuItem_StoriesArchiveDeleteMutation",variables:{input:{archived_story_card_id:i,actor_id:await o()}},doc_id:8763985503642972}),r=n(u);return console.log(r),(null==(d=null==(e=null==r?void 0:r.data)?void 0:e.archived_story_card_delete)?void 0:d.deleted_archived_story_card_id)===i}export{c as deleteArchivedStory,r as getArchivedStories,t as getArchivedStoriesContent,s as getFirstStoryBucketIdToShow,d as getRecentStories,u as getStoriesBucketsData,v as getStoryViewers,_ as reactStory};
