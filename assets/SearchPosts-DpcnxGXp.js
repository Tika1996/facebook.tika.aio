const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./MyTable-D1FbPMwN.js","./index-DZEcYG8Q.js","./index-C6k8ZUm0.css","./MyApp-DRRa55Bd.js","./index-BA5m7QhG.js","./index-DOt91uSA.js","./DownOutlined-BrkIPj-I.js","./Table-DDck-vB7.js","./addEventListener-C9VBchln.js","./List-BPJoeCz4.js","./index-BRk8JeT5.js","./index-CEGXIRel.js","./index-BQAhaSn9.js","./index-KPoWFIyW.js","./dropdown-BoVCRztz.js","./Dropdown-BgvXKd3u.js","./PurePanel-Beni9Vkb.js","./move-Bzyc79vL.js","./index-D9U4WvIE.js","./index-CvALG2oX.js","./SearchOutlined-Bh66KhXc.js","./useBreakpoint-HjQEkdEA.js","./Pagination-Dv2YSLQ3.js","./Input-LTpJ6AuY.js","./row-BgRGnxnv.js","./index-B87p3I4c.js","./EyeOutlined-BBPXKIU8.js","./UploadModal-DObBV9ds.js","./index-iP3EwXx5.js","./index-CjG_XAWm.js","./progress-DrPKzQLC.js","./ProfileCard-78JF4fiM.js","./index-B2BHea4N.js","./index-CiDxWY8X.js","./index-BE0FsmaM.js","./copy-Ddr5DXUq.js"])))=>i.map(i=>d[i]);
import{b0 as e,r as t,b1 as a,b5 as n,b2 as i,aY as o}from"./index-DZEcYG8Q.js";import{S as r}from"./Screen-1_H4V3tg.js";import s from"./useCacheState-D4ghBCVU.js";import{u as l,d as c,t as d,j as u,A as h,c as p,z as m,S as f,T as v,e as g,f as x,I as j,aI as y,C as b}from"./MyApp-DRRa55Bd.js";import{d as S}from"./dayjs.min-BxbhFvXw.js";import{getUidFromUrl as _}from"./getIds-BE6G2xp0.js";import{a as w}from"./search-Dd69rUyC.js";import k from"./sweetalert2.esm.all-BZxvatOx.js";import P from"./ExportButton-CPuYvz9B.js";import{checkVIP as T}from"./useVIP-CGpIDALh.js";import{D as N}from"./index-DHhmxYJT.js";import{C}from"./index-B2BHea4N.js";import{F as U}from"./Table-DDck-vB7.js";import{I as D}from"./index-B87p3I4c.js";import{S as I}from"./index-D9U4WvIE.js";import{S as E}from"./index-l5dW_dFo.js";import{D as A}from"./index-B0BghIXV.js";import"./col-DLTiGXF3.js";import"./row-BgRGnxnv.js";import"./useBreakpoint-HjQEkdEA.js";import"./index-KPoWFIyW.js";import"./dropdown-BoVCRztz.js";import"./Dropdown-BgvXKd3u.js";import"./PurePanel-Beni9Vkb.js";import"./move-Bzyc79vL.js";import"./Input-LTpJ6AuY.js";import"./EyeOutlined-BBPXKIU8.js";import"./SearchOutlined-Bh66KhXc.js";import"./index-CiDxWY8X.js";import"./addEventListener-C9VBchln.js";import"./List-BPJoeCz4.js";import"./DownOutlined-BrkIPj-I.js";import"./index-BRk8JeT5.js";import"./index-CEGXIRel.js";import"./index-BQAhaSn9.js";import"./Pagination-Dv2YSLQ3.js";import"./index-CvALG2oX.js";const O=i((()=>o((()=>import("./MyTable-D1FbPMwN.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url)),{fallback:b}),L=i((()=>o((()=>import("./UploadModal-DObBV9ds.js")),__vite__mapDeps([27,1,2,3,28,16,29,21,26,30]),import.meta.url)),{fallback:b}),R=i((()=>o((()=>import("./ProfileCard-78JF4fiM.js")),__vite__mapDeps([31,1,2,3,32,33,15,34,26,8]),import.meta.url)),{fallback:j});function B(){var i;const{ti:j}=l(),{message:b}=c(),B=e(),[J,F]=s("SearchPosts.searchText",""),[M,V]=s("SearchPosts.searchType","global"),[$,z]=s("SearchPosts.targetUid",""),[Y,q]=s("SearchPosts.targetProfile",null),[G,H]=t.useState(!1),[K,W]=s("SearchPosts.recentPost",!1),[X,Q]=s("SearchPosts.interactedPost",!1),[Z,ee]=s("SearchPosts.author",""),[te,ae]=s("SearchPosts.dates",[null,null]),[ne,ie]=s("SearchPosts.locationText",""),[oe,re]=s("SearchPosts.locationResult",[]),[se,le]=t.useState(!1),[ce,de]=s("SearchPosts.location",null),[ue,he]=s("SearchPosts.authorUid",""),[pe,me]=s("SearchPosts.authorProfile",null),[fe,ve]=t.useState(!1),[ge,xe]=s("SearchPosts.templates",[],!0),[je,ye]=s("SearchPosts.importText",""),be=t.useMemo((()=>{var e;return(null==(e=[...ge||[]])?void 0:e.sort(((e,t)=>t.createdAt-e.createdAt)))||[]}),[ge]);t.useEffect((()=>{var e;(null==(e=B.state)?void 0:e.targetUid)&&(V("local"),z(B.state.targetUid))}),[null==(i=B.state)?void 0:i.targetUid]),t.useEffect((()=>{d("SearchPosts:onLoad")}),[]),t.useEffect((()=>{if(!ne)return;const e=setTimeout((async()=>{le(!0);const e=await w(ne);console.log("location:",e),re(e),de(e[0]||null),le(!1)}),1e3);return()=>clearTimeout(e)}),[ne]),t.useEffect((()=>{if(!ue)return;const e=setTimeout((async()=>{ve(!0);const e=await _(ue);if(console.log("uid:",e),ve(!1),e){if(e!==(null==pe?void 0:pe.uid)){he(e);const t=await u(e);console.log("profile:",t),t?me(t):b.error({content:j({en:"Cannot found author profile",vi:"Không tìm thấy profile người đăng"})})}}else b.error({content:j({en:"Cannot found author UID",vi:"Không tìm thấy UID người đăng"})})}),1e3);return()=>clearTimeout(e)}),[ue]),t.useEffect((()=>{if(!$)return;const e=setTimeout((async()=>{H(!0);const e=await _($);if(console.log("uid:",e),H(!1),e){if(e!==(null==Y?void 0:Y.uid)){z(e);const t=await u(e);console.log("profile:",t),t?q(t):b.error({content:j({en:"Cannot found target profile",vi:"Không tìm thấy profile đối tượng"})})}}else b.error({content:j({en:"Cannot found target UID",vi:"Không tìm thấy UID đối tượng"})})}),1e3);return()=>clearTimeout(e)}),[$]);const Se=async()=>{const e=await k.fire({title:j({en:"Enter template name",vi:"Nhập tên mẫu"}),input:"text",inputPlaceholder:j({en:"Enter template name",vi:"Nhập tên mẫu"}),inputAttributes:{autocapitalize:"off",autocomplete:"off",autocorrect:"off",spellcheck:"false"}});if(!e.isConfirmed||!e.value)return;const t={recentPost:K,interactedPost:X,author:Z,authorUid:ue,dates:te.map((e=>null==e?void 0:e.format("YYYY-MM-DD"))),locationText:ne,location:ce,searchText:J,searchType:M,targetUid:$};console.log("currentFilters:",t),d("SearchPosts:onSaveFilterAsTemplate"),xe((a=>[...a||[],{id:y(5),name:e.value,filters:t,createdAt:Date.now()}])),b.success({content:j({en:"Template saved",vi:"Mẫu đã được lưu"})})},_e=async e=>{if(!(await k.fire({title:j({en:"Are you sure you want to delete "+e.length+" templates?",vi:"Bạn có chắc chắn muốn xoá "+e.length+" mẫu không?"}),text:j({en:"This action cannot be undone",vi:"Hành động này không thể hoàn tác"}),icon:"warning",showCancelButton:!0,confirmButtonText:j({en:"Delete",vi:"Xoá"}),cancelButtonText:j({en:"Cancel",vi:"Hủy"})})).isConfirmed)return;const t=new Set(e.map((e=>e.id)));xe((e=>null==e?void 0:e.filter((e=>!t.has(e.id))))),d("SearchPosts:onDeleteTemplates")},we=async e=>{if(!(await T()))return;const t=e||je;if(!t)return b.error(j({en:"No data",vi:"Không có dữ liệu"}));console.log("templateData:",t);try{const e=JSON.parse(t);if(Array.isArray(e)&&e.length)xe((t=>[...t||[],...e.map((e=>{const t=y(5);return{...e,id:t,key:t}}))])),b.success({content:j({en:"Templates imported",vi:"Mẫu đã được nhập"})+": "+e.length});else{const t=await k.fire({title:j({en:"Enter template name",vi:"Nhập tên mẫu"}),input:"text",inputPlaceholder:j({en:"Enter template name",vi:"Nhập tên mẫu"}),inputAttributes:{autocapitalize:"off",autocomplete:"off",autocorrect:"off",spellcheck:"false"}}),a={id:y(5),name:t.value,filters:e,createdAt:Date.now()};xe((e=>[...e||[],a])),b.success({content:j({en:"Template imported",vi:"Mẫu đã được nhập"})})}ye(""),d("SearchPosts:onUploadTemplates")}catch(a){return console.error("Error parsing JSON:",t,a),b.error(j({en:"Invalid data",vi:"Dữ liệu không hợp lệ"})+" "+a)}};return a.jsx(r,{title:j({en:"Search posts",vi:"Tìm kiếm bài viết"}),mode:"center",children:a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10,maxWidth:"100%",alignItems:"center"},children:[a.jsx(h,{showIcon:!0,message:a.jsxs(a.Fragment,{children:[j({en:"Search posts on Facebook",vi:"Tìm kiếm bài viết trên Facebook"})," ",a.jsxs("a",{href:"https://www.facebook.com/groups/fbaio/posts/1733429543978393",target:"_blank",children:[j({en:"Read more",vi:"Đọc thêm"})," ",a.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})]})]})}),a.jsx(C,{title:j({en:"Filters",vi:"Bộ lọc"}),styles:{header:{padding:10},body:{padding:10}},extra:a.jsxs(f.Compact,{children:[a.jsx(v,{title:j({en:"Save current filter as template",vi:"Lưu bộ lọc hiện tại thành mẫu"}),children:a.jsx(n,{icon:a.jsx("i",{className:"fa-solid fa-save"}),onClick:Se,children:j({en:"Save",vi:"Lưu"})})}),a.jsx(v,{title:j({en:"Reset filters",vi:"Đặt lại bộ lọc"}),children:a.jsx(n,{onClick:()=>{V("global"),z(""),q(null),F("*"),W(!1),Q(!1),ee(""),he(""),me(null),ae([null,null]),ie(""),re([]),de(null)},icon:a.jsx("i",{className:"fa-solid fa-arrow-rotate-left"}),children:j({en:"Reset",vi:"Đặt lại"})})})]}),children:a.jsx(f,{direction:"vertical",children:a.jsx(U,{rowClassName:()=>"no-border-row",showHeader:!1,bordered:!1,pagination:!1,size:"small",columns:[{title:j({en:"Option",vi:"Tùy chọn"}),key:"label",dataIndex:"label"},{title:j({en:"Value",vi:"Giá trị"}),key:"value",dataIndex:"value"}],dataSource:[{key:"search_text",label:j({en:"Search text",vi:"Từ khóa tìm kiếm"}),value:a.jsx(D,{value:J,onChange:e=>F(e.target.value),allowClear:!0,placeholder:j({en:"Enter search text",vi:"Nhập từ khóa tìm kiếm"})})},{key:"search_type",label:j({en:"Search range",vi:"Phạm vi tìm kiếm"}),value:a.jsxs(f,{direction:"vertical",children:[a.jsx(I,{popupMatchSelectWidth:!1,options:[{value:"global",label:j({en:"Global",vi:"Toàn facebook"})},{value:"local",label:j({en:"Target",vi:"Đối tượng cụ thể"})}],value:M,onChange:V}),"local"===M&&a.jsxs(a.Fragment,{children:[a.jsx(D,{placeholder:j({en:"Enter target URL/UID",vi:"Nhập URL/UID đối tượng"}),value:$,onChange:e=>z(e.target.value),disabled:G,allowClear:!0}),Y&&a.jsx(R,{about:Y,onClose:()=>{q(null),z("")},showUid:!0})]})]})},{key:"recent",label:j({en:"Recent posts",vi:"Bài viết gần đây"}),value:a.jsx(E,{checked:K,onChange:W})},{key:"interacted",label:j({en:"Posts you've seen",vi:"Bài viết đã xem"}),value:a.jsx(E,{checked:X,onChange:Q})},{key:"author",label:j({en:"Posts from",vi:"Người đăng"}),value:a.jsxs(f,{direction:"vertical",size:"small",children:[a.jsx(I,{popupMatchSelectWidth:!1,options:[{value:"",label:j({en:"Anyone",vi:"Bất kỳ ai"})},{value:"author_me",label:j({en:"You",vi:"Bạn"})},{value:"author_friends_feed",label:j({en:"Your friends",vi:"Bạn bè của bạn"})},{value:"my_groups_posts",label:j({en:"Groups you joined",vi:"Nhóm bạn tham gia"})},{value:"my_groups_and_pages_posts",label:j({en:"Groups and pages you joined",vi:"Nhóm và trang bạn tham gia"})},{value:"merged_public_posts",label:j({en:"Public posts",vi:"Bài viết công khai"})},{value:"specific_author",label:j({en:"Specific author..",vi:"Người đăng cụ thể.."})}],value:Z,onChange:ee,loading:fe,disabled:fe}),"specific_author"==Z&&a.jsxs(a.Fragment,{children:[a.jsx(D,{placeholder:j({en:"Enter author UID/URL",vi:"Nhập UID/URL người đăng"}),value:ue,onChange:e=>he(e.target.value),disabled:fe,allowClear:!0}),pe&&a.jsx(R,{about:pe,onClose:()=>{me(null),he(""),ee("")},showUid:!0})]})]})},{key:"creation_time",label:j({en:"Date posted",vi:"Ngày đăng"}),value:a.jsx(A.RangePicker,{value:te,onChange:ae,allowClear:!0,allowEmpty:!0})},{key:"location",label:j({en:"Tagged location",vi:"Vị trí được gắn thẻ"}),value:a.jsxs(f,{direction:"vertical",children:[a.jsx(D,{placeholder:j({en:"Search location",vi:"Tìm vị trí"}),value:ne,onChange:e=>ie(e.target.value),allowClear:!0,prefix:a.jsx("i",{className:"fa-solid "+(se?"fa-spinner fa-spin":"fa-location-dot")}),disabled:se}),oe.length>0&&a.jsx(I,{allowClear:!0,popupMatchSelectWidth:!1,value:null==ce?void 0:ce.uid,onChange:e=>de(oe.find((t=>t.uid===e))||null),options:oe.map((e=>({value:e.uid,label:e.label}))),style:{width:"100%"}})]})}]})})}),a.jsx(n,{type:"primary",onClick:()=>{var e,t,a,n,i,o,r,s;if(!(null==(e=J.trim())?void 0:e.length))return b.error({content:j({en:"Please enter search text",vi:"Vui lòng nhập từ khóa tìm kiếm"})});d("SearchPosts:onOpenFbSearch");const l={},c="global"===M||!(null==Y?void 0:Y.uid);if(K&&(c?l.recent_posts=JSON.stringify({name:"recent_posts",args:""}):l.rp_chrono_sort=JSON.stringify({name:"chronosort",args:""})),X&&(l.seen_posts=JSON.stringify({name:"interacted_posts",args:""})),Z)if("specific_author"===Z){if(!ue)return b.error({content:j({en:"Please enter author UID/URL",vi:"Vui lòng nhập UID/URL người đăng"})});l.rp_author=JSON.stringify({name:"author",args:ue})}else"my_groups_posts"===Z?l.rp_group=JSON.stringify({name:"my_groups_posts",args:""}):l.rp_author=JSON.stringify({name:Z,args:""});if((null==ce?void 0:ce.uid)&&(l.rp_location=JSON.stringify({name:"location",args:ce.uid})),null==(t=null==te?void 0:te.some)?void 0:t.call(te,(e=>e))){const e={year:null==(a=te[0])?void 0:a.year(),month:(null==(n=te[0])?void 0:n.month())+1,day:null==(i=te[0])?void 0:i.date()},t={year:null==(o=te[1])?void 0:o.year(),month:(null==(r=te[1])?void 0:r.month())+1,day:null==(s=te[1])?void 0:s.date()};l.rp_creation_time=JSON.stringify({name:"creation_time",args:JSON.stringify({start_year:e.year+"",start_month:e.year+"-"+e.month,start_day:e.year+"-"+e.month+"-"+e.day,end_year:t.year+"",end_month:t.year+"-"+t.month,end_day:t.year+"-"+t.month+"-"+t.day})})}console.log("filters:",l);try{const e=btoa(JSON.stringify(l));console.log(Y);const t=c?`https://www.facebook.com/search/posts/?q=${J}&filters=${e}`:(null==Y?void 0:Y.type)===m.Group?`https://www.facebook.com/groups/${null==Y?void 0:Y.uid}/search?q=${J}&filters=${e}`:`https://www.facebook.com/profile/${null==Y?void 0:Y.uid}/search?q=${J}&filters=${e}`;window.open(t+"&epa=FILTERS","_blank")}catch(u){console.error("Error opening URL:",u),b.error({content:j({en:"Error opening URL",vi:"Lỗi khi mở URL"})+" "+((null==u?void 0:u.message)||u)})}},icon:a.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"}),iconPosition:"end",children:j({en:"Search posts",vi:"Tìm kiếm bài viết"})}),(null==ge?void 0:ge.length)>0&&a.jsxs(a.Fragment,{children:[a.jsx(N,{}),a.jsx(p.Title,{level:4,style:{margin:0},children:j({en:"Saved templates",vi:"Mẫu đã lưu"})}),a.jsx(O,{searchable:!0,selectable:!0,data:be,keyExtractor:e=>e.id,renderTitle:e=>{const t=(null==e?void 0:e.length)?e:be;return a.jsxs(f,{wrap:!0,children:[a.jsx(L,{onSubmit:we,onData:ye,renderButton:({showModal:e})=>a.jsx(n,{icon:a.jsx("i",{className:"fa-solid fa-plus"}),onClick:e,children:j({en:"Import",vi:"Nhập"})}),suffix:a.jsxs(f,{direction:"vertical",style:{width:"100%"},children:[a.jsx(N,{}),a.jsxs(p.Text,{children:[j({en:"Or enter manually",vi:"Hoặc nhập thủ công"}),":"]}),a.jsx(D.TextArea,{placeholder:j({en:"Enter shared filters text here..",vi:"Nhập bộ lọc được chia sẻ ở đây.."}),value:je,onChange:e=>ye(e.target.value),rows:5})]})}),a.jsx(P,{data:t,options:[{key:"json",label:".json",prepareData:e=>({data:JSON.stringify(e,null,4),fileName:"search_posts_templates.json"})}]}),a.jsx(v,{title:j({en:"Delete "+t.length+" selected templates",vi:"Xoá "+t.length+" mẫu đang chọn"}),children:a.jsxs(n,{danger:!0,icon:a.jsx("i",{className:"fa-solid fa-trash"}),onClick:()=>_e(t),children:[j({en:"Delete",vi:"Xoá"})," ",t.length]})})]})},columns:[{title:"#",dataIndex:"index",key:"index",render:(e,t,a)=>a+1,width:50},{title:j({en:"Created at",vi:"Ngày tạo"}),dataIndex:"createdAt",key:"createdAt",render:(e,t,n)=>a.jsxs(f,{direction:"vertical",size:0,children:[a.jsxs("span",{children:[g(t.createdAt)," ",j({en:"ago",vi:"trước"})]}),a.jsx("span",{children:x(t.createdAt)})]}),width:150},{title:j({en:"Name",vi:"Tên mẫu"}),dataIndex:"name",key:"name",width:150},{title:j({en:"Filters",vi:"Bộ lọc"}),dataIndex:"filters",key:"filters",render:(e,t,n)=>a.jsx(D.TextArea,{value:JSON.stringify(t.filters,null,2),rows:5,style:{maxWidth:300}})},{title:j({en:"Action",vi:"Hành động"}),dataIndex:"action",key:"action",render:(e,t,i)=>a.jsxs(f,{size:"small",children:[a.jsx(v,{title:j({en:"Apply template",vi:"Áp dụng mẫu"}),children:a.jsx(n,{icon:a.jsx("i",{className:"fa-solid fa-arrow-up"}),onClick:()=>(e=>{F(e.filters.searchText),V(e.filters.searchType),z(e.filters.targetUid),W(e.filters.recentPost),Q(e.filters.interactedPost),ee(e.filters.author),he(e.filters.authorUid),ae(e.filters.dates.map((e=>e?S(e):null))),ie(e.filters.locationText),de(e.filters.location),d("SearchPosts:onApplyTemplate")})(t)})}),a.jsx(v,{title:j({en:"Share template",vi:"Chia sẻ mẫu"}),children:a.jsx(n,{icon:a.jsx("i",{className:"fa-solid fa-share"}),onClick:()=>{o((async()=>{const{copy:e}=await import("./copy-Ddr5DXUq.js");return{copy:e}}),__vite__mapDeps([35,1,2]),import.meta.url).then((({copy:e})=>{e(JSON.stringify(t,null,2)).then((()=>{b.success({content:j({en:"Copied to clipboard. Share it with your friends",vi:"Đã sao chép vào clipboard. Hãy chia sẻ với bạn bè"})})})).catch((()=>{b.error({content:j({en:"Failed to copy. Please manually copy filters",vi:"Lỗi khi sao chép. Vui lòng sao chép bộ lọc bằng tay"})})}))}))}})}),a.jsx(v,{title:j({en:"Delete template",vi:"Xoá mẫu"}),children:a.jsx(n,{danger:!0,icon:a.jsx("i",{className:"fa-solid fa-trash"}),onClick:()=>_e([t])})})]}),width:150}]})]})]})})}export{B as default};
