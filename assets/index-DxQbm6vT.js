import{r as e,b1 as i,b5 as t,bi as n}from"./index-DZEcYG8Q.js";import{F as o,g as l,a as s,b as a,c as r,f as d,u as c,d as h}from"./follows-wg-oO9TY.js";import{u as m,d as f,v as u,W as g,s as p,S as x,i as j,b as w,T as v,A as y,o as k,h as F,t as b}from"./MyApp-DRRa55Bd.js";import L from"./MyTable-D1FbPMwN.js";import T from"./ExportButton-CPuYvz9B.js";import{u as N}from"./useAction-DQs_XsxB.js";import O from"./useCacheState-D4ghBCVU.js";import C from"./WordStatisticButton-BogWpezO.js";import{B as S}from"./BadgeWrapper-D8uZ2wKG.js";import{u as I}from"./useDevMode-DFNrRWnS.js";import{S as B}from"./Screen-1_H4V3tg.js";import{getAllFriends as D}from"./friends-CSFyeA5q.js";import{A as U}from"./index-DhxhS065.js";import{I as W}from"./index-BE0FsmaM.js";import"./index-BA5m7QhG.js";import"./index-DOt91uSA.js";import"./DownOutlined-BrkIPj-I.js";import"./Table-DDck-vB7.js";import"./addEventListener-C9VBchln.js";import"./List-BPJoeCz4.js";import"./index-BRk8JeT5.js";import"./index-CEGXIRel.js";import"./index-BQAhaSn9.js";import"./index-KPoWFIyW.js";import"./dropdown-BoVCRztz.js";import"./Dropdown-BgvXKd3u.js";import"./PurePanel-Beni9Vkb.js";import"./move-Bzyc79vL.js";import"./index-D9U4WvIE.js";import"./index-CvALG2oX.js";import"./SearchOutlined-Bh66KhXc.js";import"./useBreakpoint-HjQEkdEA.js";import"./Pagination-Dv2YSLQ3.js";import"./Input-LTpJ6AuY.js";import"./row-BgRGnxnv.js";import"./index-B87p3I4c.js";import"./EyeOutlined-BBPXKIU8.js";import"./useVIP-CGpIDALh.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-BE6G2xp0.js";import"./index-CiDxWY8X.js";import"./index-DHhmxYJT.js";import"./index-l5dW_dFo.js";import"./index-iP3EwXx5.js";import"./col-DLTiGXF3.js";import"./gender-D7cqwEK5.js";import"./index-C0Edlh-n.js";function E(){const{ti:E}=m(),{message:P,notification:_}=f(),{onClickAction:A,onClickBulkActions:M}=N(),{devMode:R}=I(),[G,q]=O("Follows.friends",[]),[z,J]=O("Follows.data",[]),[K,V]=e.useState(!1),[X,$]=O("Follows.loadingFollowBulk",!1),[H,Q]=O("Follows.loadingUnFollowBulk",!1),[Y,Z]=O("Follows.loadingRecord",{}),[ee,ie]=O("Follows.loadingUnfollowed",!1),[te,ne]=e.useMemo((()=>[z.filter((e=>e.status===o.FOLLOWING)),z.filter((e=>e.status===o.UNFOLLOWED))]),[z]),oe=e.useRef(null);e.useEffect((()=>{se()}),[]);const le=e.useRef(!1),se=async(e=!1)=>{if(le.current||K)return;le.current=!0;const i="Follows:onReload";P.loading({key:i,content:E({en:"Loading following...",vi:"Đang tải người bạn theo dõi..."}),duration:0}),V(!0);const t=e?[]:z,n=new Set(t.map((e=>e.id)));for(const[r,d]of[[l,E({en:"Loading following (option 1)... ",vi:"Đang tải người theo dõi (cách 1)... "})],[s,E({en:"Loading following (option 2)... ",vi:"Đang tải người theo dõi (cách 2)... "})]]){let e=null;for(;;){let o;P.loading({key:i,content:d+t.length,duration:0});try{o=await r(e)}catch(a){console.error(a)}if(!(null==o?void 0:o.length))break;let l=!1;for(let e of o)n.has(e.id)||(t.push(e),n.add(e.id),l=!0);if(!l)break;J([...t.map(((e,i)=>({...e,i:i+1})))]),e=o[o.length-1].cursor,await u(300)}}P.loading({key:i,content:E({en:"Loading friends...",vi:"Đang tải danh sách bạn bè..."}),duration:0});const o=await D({myUid:await g()});q(o),P.success({key:i,content:E({en:"Finish loading follows: ",vi:"Tải xong danh sách theo dõi: "})+t.length}),V(!1),le.current=!1},ae=(e,i)=>{var t,o,l,s;J((t=>n(t,(t=>{const n=t.find((i=>i.id===e.id));return n&&(n.status=i),t}))));const a=null==(o=null==(t=oe.current)?void 0:t.getDataSelected)?void 0:o.call(t);a&&(null==(s=null==(l=oe.current)?void 0:l.setDataSelected)||s.call(l,a.filter((i=>i.id!==e.id))))},re=(e,i=!1)=>(Z((i=>({...i,[e.id]:!0}))),A({record:e,id:e.id,key:"Follows:onClickFollow",actionFn:()=>R?u(1e3):d(e),loadingText:()=>E({en:"Following...",vi:"Đang theo dõi..."})+" "+e.name,successText:()=>E({en:"Followed",vi:"Đã theo dõi"})+" "+e.name,failedText:()=>E({en:"Failed to follow",vi:"Lỗi theo dõi"})+" "+e.name,onSuccess:()=>{ae(e,o.FOLLOWING)},needConfirm:i,confirmProps:{title:E({en:"Follow?",vi:"Theo dõi?"}),text:e.name}}).finally((()=>{Z((i=>({...i,[e.id]:!1})))}))),de=(e,i=!0)=>(Z((i=>({...i,[e.id]:!0}))),A({record:e,id:e.id,key:"Follows:onClickUnFollow",actionFn:()=>R?u(1e3):c(e),loadingText:()=>E({en:"Unfollowing...",vi:"Đang bỏ theo dõi..."})+" "+e.name,successText:()=>E({en:"Unfollowed",vi:"Đã bỏ theo dõi"})+" "+e.name,failedText:()=>E({en:"Failed to unfollow",vi:"Lỗi bỏ theo dõi"})+" "+e.name,onSuccess:()=>{ae(e,o.UNFOLLOWED)},needConfirm:i,confirmProps:{title:E({en:"Unfollow?",vi:"Bỏ theo dõi?"}),text:e.name}}).finally((()=>{Z((i=>({...i,[e.id]:!1})))}))),ce=async()=>{const e="Follows:onClickLoadUnfollowed";b(e),P.loading({key:e,content:E({en:"Loading unfollowed...",vi:"Đang tải lịch sử bỏ theo dõi..."}),duration:0}),ie(!0);const t=[];let o="",l=!1;for(;!l;){const s=await h(o);if(console.log(s),!s.length)break;t.push(...s),o=s[s.length-1].cursor,P.loading({key:e,content:i.jsxs(i.Fragment,{children:[E({en:"Loading unfollowed...",vi:"Đang tải lịch sử bỏ theo dõi..."})+" "+t.length,i.jsx("br",{}),E({en:"Click to stop",vi:"Bấm để dừng"})]}),duration:0,onClick:()=>l=!0}),J((e=>n(e,(e=>{for(let i of s){const t=e.findIndex((e=>e.id===i.id));-1!==t?e[t]=i:e.unshift(i)}return e})))),await u(1e3)}P.destroy(e),_.open({type:"success",message:E({en:"Load unfollowed success",vi:"Tải xong lịch sử bỏ theo dõi"}),description:E({en:"Found "+t.length+" users you have unfollowed",vi:"Tìm thấy "+t.length+" người bạn từng bỏ theo dõi"}),duration:0}),ie(!1)},he=e.useMemo((()=>{const e=new Set(G.map((e=>e.uid)));return z.filter((i=>e.has(i.id))).length}),[G,z]),me=[{title:"#",dataIndex:"i",width:50,sorter:(e,i)=>e.i-i.i},{title:E({en:"Name",vi:"Tên"}),key:"name",dataIndex:"name",sorter:(e,i)=>(e.name||"").localeCompare(i.name||""),render:(e,t,n)=>i.jsxs(x,{align:"center",style:{maxWidth:400},children:[i.jsx(U,{shape:"square",src:i.jsx(W,{src:j(t.id),fallback:t.avatar}),size:50}),i.jsxs(x,{direction:"vertical",style:{marginLeft:"10px"},size:0,children:[i.jsx("a",{href:t.url,target:"_blank",children:i.jsx("b",{children:t.name})}),i.jsx("span",{style:{opacity:.5},children:t.id})]})]}),onSearch:(e,i,t)=>p(e,t.name+t.id),width:"auto"},{title:E({en:"Desc",vi:"Mô tả"}),key:"desc",dataIndex:"desc",render:(e,t,n)=>i.jsx("p",{style:{maxWidth:300,minWidth:50},children:e}),sorter:(e,i)=>(e.desc||"").localeCompare(i.desc||"")},{title:E({en:"Type",vi:"Loại"}),key:"type",dataIndex:"type",filters:Object.entries(a).map((([e,i])=>({text:i+" ("+z.filter((e=>e.type===i)).length+")",value:i}))),onFilter:(e,i)=>i.type===e,width:120},{title:he+" "+E({en:"Friend",vi:"Bạn bè"}),key:"friend",dataIndex:"friend",render:(e,t,n)=>new Set(G.map((e=>e.uid))).has(t.id)?i.jsx(w,{color:"success",children:E({en:"Friend",vi:"Bạn bè"})}):"-",filters:[{text:E({en:"Friend: ",vi:"Bạn bè: "})+he,value:!0},{text:E({en:"No: ",vi:"Không: "})+(z.length-he),value:!1}],onFilter:(e,i)=>new Set(G.map((e=>e.uid))).has(i.id)===e,width:120},{title:E({en:"Status",vi:"Trạng thái"}),key:"status",dataIndex:"status",render:(e,t,n)=>{const l=E(r[t.status]);return t.status===o.UNFOLLOWED?i.jsx(w,{color:"error",children:l}):l},filters:Object.entries(r).map((([e,i])=>({text:E(i)+" ("+z.filter((i=>i.status===e)).length+")",value:e}))),onFilter:(e,i)=>i.status===e,width:150},{title:E({en:"Action",vi:"Hành động"}),key:"action",dataIndex:"action",render:(e,n,l)=>n.status===o.FOLLOWING?i.jsx(v,{title:E({en:"UnFollow",vi:"Bỏ theo dõi"}),mouseEnterDelay:.5,children:i.jsx(t,{danger:!0,type:"default",icon:i.jsx("i",{className:"fa-solid fa-trash"}),onClick:()=>de(n),loading:Y[n.id]})}):i.jsx(v,{title:E({en:"Follow",vi:"Theo dõi"}),mouseEnterDelay:.5,children:i.jsx(t,{type:"text",onClick:()=>re(n,!0),icon:i.jsx("i",{className:"fa-regular fa-square-plus fa-xl"}),loading:Y[n.id]})}),align:"right",width:100}];return i.jsx(B,{title:E({en:"Follows",vi:"Theo dõi"}),titleSuffix:i.jsxs(x,{align:"center",style:{justifyContent:"center"},children:[i.jsx(w,{style:{marginLeft:10,fontWeight:"bold",color:"#888"},children:z.filter((e=>e.status===o.FOLLOWING)).length}),i.jsx(y,{message:i.jsxs(i.Fragment,{children:[E({en:"Follows count not correct?",vi:"Số lượng theo dõi không đúng?"})," ",i.jsxs("a",{href:"https://www.facebook.com/groups/1154059318582088/posts/1734091583912189/",target:"_blank",children:[E({en:"See why",vi:"Xem lý do"})," ",i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})]})]}),type:"info",showIcon:!0,closable:!0})]}),children:i.jsx(L,{ref:oe,data:z,columns:me,renderTitle:e=>{const n=e.length?e.filter((e=>e.status===o.FOLLOWING)):te,l=e.length?e.filter((e=>e.status===o.UNFOLLOWED)):ne;return i.jsxs(i.Fragment,{children:[i.jsx(t,{type:"primary",icon:K?i.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):i.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>se(!0),children:E({en:"Reload",vi:"Tải lại"})}),i.jsx(T,{data:e.length?e:te,options:[{key:"uid",label:".txt (uid)",prepareData:e=>({fileName:"followings_uid.txt",data:e.map((e=>e.id)).join("\n")})},{key:"uid_name",label:".csv (uid+name)",prepareData:e=>({fileName:"followings_uid_name.csv",data:k(e.map((e=>({uid:e.id,name:e.name}))))})},{key:"json",label:".json",prepareData:e=>({fileName:"followings.json",data:JSON.stringify(e,null,2)})},{key:"csv",label:".csv",prepareData:e=>({fileName:"followings.csv",data:k(e)})}]}),n.length>0&&i.jsx(v,{title:E({en:"Unfollow "+n.length+" selected",vi:"Bỏ theo dõi "+n.length+" người đang chọn"}),children:i.jsx(t,{type:"default",danger:!0,icon:i.jsx("i",{className:"fa-solid fa-trash"}),disabled:0===n.length,loading:H,onClick:()=>{return e=n,Q(!0),M({data:e,key:"Follows:onClickUnFollowBulk",actionFn:e=>de(e,!1),loadingText:e=>E({en:"Unfollowing...",vi:"Đang bỏ theo dõi..."}),successText:(e,i)=>E({en:"Unfollow finished",vi:"Đã bỏ theo dõi xong"}),successDescItem:e=>i.jsx("a",{target:"_blank",href:F(e.id),children:e.name}),confirmProps:{title:E({en:"Unfollow "+e.length+" selected?",vi:"Bỏ theo dõi "+e.length+" người?"})}}).finally((()=>{Q(!1)}));var e},children:n.length})}),l.length>0&&i.jsx(v,{title:E({en:"Follow "+l.length+" selected",vi:"Theo dõi "+l.length+" người đang chọn"}),children:i.jsx(t,{type:"default",icon:i.jsx("i",{className:"fa-solid fa-plus"}),disabled:0===l.length,loading:X,onClick:()=>{return e=l,$(!0),M({data:e,key:"Follows:onClickFollowBulk",actionFn:re,loadingText:e=>E({en:"Following...",vi:"Đang theo dõi..."}),successText:(e,i)=>E({en:"Follow finished",vi:"Đã theo dõi xong"}),successDescItem:e=>i.jsx("a",{target:"_blank",href:F(e.id),children:e.name}),confirmProps:{title:E({en:"Follow "+e.length+" selected?",vi:"Theo dõi "+e.length+" người?"}),text:E({en:"Are you sure?",vi:"Bạn chắc chứ?"})}}).finally((()=>{$(!1)}));var e},children:l.length})}),i.jsx(S,{type:"new",children:i.jsx(v,{title:E({en:"Load all your unfollowed users",vi:"Tải danh sách người bạn đã bỏ theo dõi"}),children:i.jsx(t,{icon:i.jsx("i",{className:"fa-solid fa-clock-rotate-left"}),loading:ee,onClick:ce,children:E({en:"Old following",vi:"Theo dõi cũ"})})})}),i.jsx(C,{name:"Follows",text:z.map((e=>e.name)).join(" ")}),i.jsx(v,{title:E({en:"View on Facebook",vi:"Xem trên Facebook"}),children:i.jsx(t,{type:"default",icon:i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"}),onClick:()=>window.open("https://www.facebook.com/me/following","_blank")})})]})},size:"small",searchable:!0,selectable:!0,keyExtractor:e=>e.id})})}export{E as default};
