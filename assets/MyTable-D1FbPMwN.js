import{r as e,b1 as t,b5 as n}from"./index-DZEcYG8Q.js";import{u as l,s as r,c as i,S as s}from"./MyApp-DRRa55Bd.js";import{u as o}from"./index-BA5m7QhG.js";import{T as a}from"./index-DOt91uSA.js";import{F as c}from"./Table-DDck-vB7.js";import{R as u}from"./row-BgRGnxnv.js";import{I as d}from"./index-B87p3I4c.js";import"./DownOutlined-BrkIPj-I.js";import"./addEventListener-C9VBchln.js";import"./List-BPJoeCz4.js";import"./index-BRk8JeT5.js";import"./index-CEGXIRel.js";import"./index-BQAhaSn9.js";import"./index-KPoWFIyW.js";import"./dropdown-BoVCRztz.js";import"./Dropdown-BgvXKd3u.js";import"./PurePanel-Beni9Vkb.js";import"./move-Bzyc79vL.js";import"./index-D9U4WvIE.js";import"./index-CvALG2oX.js";import"./SearchOutlined-Bh66KhXc.js";import"./useBreakpoint-HjQEkdEA.js";import"./Pagination-Dv2YSLQ3.js";import"./Input-LTpJ6AuY.js";import"./EyeOutlined-BBPXKIU8.js";const m=e.forwardRef(((m,h)=>{const{ti:p,language:f}=l(),{virtual:g=!1,data:S=[],columns:x=[],size:y="middle",selectable:v=!1,searchable:j=!1,searchPlaceholder:w=p({en:"Search",vi:"Tìm kiếm"}),loading:k=!1,pageSize:b=0,keyExtractor:C=(e,t)=>t+"",onSearchRow:R,renderTitle:_,style:B,footer:T,expandable:z}=m,[D,I]=e.useState(""),[M,E]=e.useState(""),[F,O]=e.useState([]),[P,H]=e.useState(!1),[L,q]=e.useState(!1),K=o(I,500),U=e.useRef(!1),A=e=>{E(e),K(e),U.current=!0};e.useImperativeHandle(h,(()=>({getDataSelected:()=>F,setDataSelected:e=>{O(e)},hasDataSelected:()=>!!(null==F?void 0:F.length),setShowSelectedOnly:H,setSearch:A,clearFilter:({search:e=!0,dataSelected:t=!0,showSelectedOnly:n=!0}={})=>{e&&A(""),t&&O([]),n&&H(!1)}})));const N=e.useMemo((()=>{const e=new Map(x.map(((e,t)=>[e.key,t]))),t=(D?S.filter((t=>R?R(D,t):Object.entries(t).some((([n,l],i)=>{var s,o;let a=e.get(n)||-1;return!(a<0)&&(!(null==(s=x[a])?void 0:s.disableSearch)&&((null==(o=x[a])?void 0:o.onSearch)?x[a].onSearch(D,l,t,L):"string"==typeof l&&(L?null==l?void 0:l.includes(D):r(D,l))))})))):S).map(((e,t)=>({...e,key:C(e,t)})));if(P&&(null==F?void 0:F.length)){const e=new Set(F.map(C));return t.filter(((t,n)=>e.has(C(t,n))))}return t}),[S,D,L,P,F,x,C,R]),W=e.useMemo((()=>x.find((e=>e.rangeFilter))?x.map((e=>e.rangeFilter?{...e,filterDropdown:({setSelectedKeys:e,selectedKeys:l,confirm:r,clearFilters:s})=>{var o,c;return t.jsxs("div",{style:{padding:8},children:[t.jsx(i.Text,{strong:!0,style:{marginBottom:8,display:"block"},children:p({en:"Range filter",vi:"Lọc giá trị"})}),t.jsx(a,{placeholder:p({vi:"Bé nhất",en:"Min"}),value:(null==(o=l[0])?void 0:o.min)??null,onChange:t=>e([{...l[0],min:t}]),style:{marginBottom:8,display:"block",width:"100%"}}),t.jsx(a,{placeholder:p({vi:"Lớn nhất",en:"Max"}),value:(null==(c=l[0])?void 0:c.max)??null,onChange:t=>e([{...l[0],max:t}]),style:{marginBottom:8,display:"block",width:"100%"}}),t.jsx(n,{type:"primary",size:"small",onClick:r,style:{width:90,marginRight:8},children:p({en:"Apply",vi:"Áp dụng"})}),t.jsx(n,{type:"link",size:"small",onClick:s,style:{width:90},children:p({en:"Reset",vi:"Đặt lại"})})]})},onFilter:(t,n)=>{const{min:l,max:r}=t||{},i=e.rangeFilter.getValue(n);return i>=(l??-1/0)&&i<=(r??1/0)},filterIcon:e=>t.jsx("i",{className:"fa fa-filter",style:{color:e?"#1890ff":void 0}})}:e)):x),[x]);e.useEffect((()=>{if(!(null==F?void 0:F.length))return;let e=new Set(S.map(C)),t=F.filter(((t,n)=>e.has(C(t,n))));(null==t?void 0:t.length)!==(null==F?void 0:F.length)&&O(t)}),[S,F]),e.useEffect((()=>{!(null==F?void 0:F.length)&&P&&H(!1)}),[F.length,P]);const $=e.useRef([]),Q=e.useRef([]),V=e.useRef(!1);e.useEffect((()=>{!V.current&&(null==F?void 0:F.length)&&Q.current.push(F),V.current=!1,$.current=F}),[F]);const G=e.useRef(N),J=e.useRef(N);e.useEffect((()=>{if(D){const e=new Set(N.map(C)),t=new Set(G.current.map(C)),n=new Set([...e].filter((e=>t.has(e))));J.current=G.current.filter((e=>n.has(C(e))))}else J.current=N,G.current=N}),[N,D]);const X=(e,t)=>{const n=new Set(S.map(C)),l=new Set(N.map(C)),r=new Set($.current.map(C)),i=new Set(e),s=new Set([...n].filter((e=>!l.has(e)))),o=new Set([...e].filter((e=>!r.has(e)))),a=new Set([...r].filter((e=>!i.has(e)&&!s.has(e)))),c=[...r,...o].filter((e=>!a.has(e))).map((e=>S.find((t=>C(t)===e)))).filter(Boolean);O(c)},Y=e.useMemo((()=>{if(!v)return;const e=[{key:"undo",text:p({en:"Undo selected",vi:"Hoàn tác lựa chọn"}),onSelect:()=>{V.current=!0;const e=Q.current.pop();console.log(e),O(Q.current[Q.current.length-1]||[])}},{key:"select_all",text:p({en:"Select all",vi:"Chọn tất cả"}),onSelect:()=>O([...J.current])},{key:"invert_selection",text:p({en:"Invert selection",vi:"Đảo ngược lựa chọn"}),onSelect:()=>O(J.current.filter((e=>!F.find((t=>C(t)===C(e))))))},{key:"unselect_all",text:p({en:"Unselect all",vi:"Bỏ chọn tất cả"}),onSelect:()=>{H(!1);const e=new Set(J.current.map(C));O(F.filter((t=>!e.has(C(t)))))}},{key:"show_selected_only",text:(P?"✅ ":"❌ ")+p({en:"Show selected only",vi:"Chỉ hiển thị đã chọn"})+" ("+F.length+")",onSelect:()=>{A(""),H(!P)}}].filter(Boolean);return D&&e.push({key:"select_all_insearch",text:p({en:"Select all - search results",vi:"Chọn tất cả - kết quả tìm kiếm"})+" ("+N.length+")",onSelect:()=>O([...J.current])},{key:"invert_selection_insearch",text:p({en:"Invert selection - search results",vi:"Đảo ngược lựa chọn - kết quả tìm kiếm"}),onSelect:()=>O(J.current.filter((e=>!F.find((t=>C(t)===C(e))))))},{key:"unselect_all_insearch",text:p({en:"Unselect all - search results",vi:"Bỏ chọn tất cả - kết quả tìm kiếm"}),onSelect:()=>{H(!1);const e=new Set(J.current.map(C));O(F.filter((t=>!e.has(C(t)))))}}),{selectedRowKeys:F.map(C),onChange:X,selections:e,type:"checkbox",getCheckboxProps:e=>({style:{minWidth:50,minHeight:50,alignItems:"center",justifyContent:"center"}})}}),[S,N,F,P,v,f,D,X]);return t.jsx(c,{sticky:{offsetHeader:0},fixedHeader:!0,size:y,loading:k,tableLayout:"auto",dataSource:N,columns:W,showSorterTooltip:!1,rowKey:C,onChange:(e,t,n,l)=>{J.current=l.currentDataSource??[],G.current=l.currentDataSource??[]},virtual:g,scroll:g?{x:"max-content",y:500}:{x:"max-content"},rowSelection:Y,title:()=>t.jsxs(u,{justify:"space-between",style:{margin:"5px"},gutter:[8,8],align:"middle",children:["function"==typeof _&&t.jsx(u,{align:"middle",children:t.jsx(s,{wrap:!0,children:_(F)})}),j&&t.jsx(s,{children:t.jsx(d.Search,{placeholder:w,value:M,onChange:e=>A(e.target.value),style:{maxWidth:300}})})]}),pagination:!g&&(-1!=b&&{position:["bottomCenter"],showSizeChanger:!0,showTotal:(e,t)=>p({en:`Total ${e} items`,vi:`Tổng ${e} dòng`}),size:"default",defaultPageSize:b||10,style:{alignItems:"center"}}),style:B,footer:T?()=>T:void 0,expandable:z})}));export{m as default};
