const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./VideoViewer-C2qoCs6p.js","./index-DZEcYG8Q.js","./index-C6k8ZUm0.css","./videos-DtjqJObU.js","./___vite-browser-external_commonjs-proxy-D5wFEbJ4.js","./MyApp-DRRa55Bd.js"])))=>i.map(i=>d[i]);
import{r as e,bh as t,b1 as i,b2 as o,b5 as a,aY as s,bp as n}from"./index-DZEcYG8Q.js";import{genParams as r,extractItemList as d}from"./core-YnJh3SAb.js";import{u as l,d as c,aH as m,B as u,c as h,S as p,e as g,f as v,aY as j,aW as x,T as f,A as w,s as k,I as y,t as b,x as I,v as T,aL as C,l as N,aM as $,aT as q}from"./MyApp-DRRa55Bd.js";import F from"./MyTable-D1FbPMwN.js";import R from"./useCacheState-D4ghBCVU.js";import S from"./WordStatisticButton-BogWpezO.js";import{waitWinForReady as B,runFnInWin as V}from"./window-B1U4aOAC.js";import D from"./ExportButton-CPuYvz9B.js";import{checkVIP as P}from"./useVIP-CGpIDALh.js";import{I as _}from"./index-BE0FsmaM.js";import{C as L}from"./index-B2BHea4N.js";import{L as O}from"./index-CG5dclLJ.js";import{R as M}from"./row-BgRGnxnv.js";import"./index-BA5m7QhG.js";import"./index-DOt91uSA.js";import"./DownOutlined-BrkIPj-I.js";import"./Table-DDck-vB7.js";import"./addEventListener-C9VBchln.js";import"./List-BPJoeCz4.js";import"./index-BRk8JeT5.js";import"./index-CEGXIRel.js";import"./index-BQAhaSn9.js";import"./index-KPoWFIyW.js";import"./dropdown-BoVCRztz.js";import"./Dropdown-BgvXKd3u.js";import"./PurePanel-Beni9Vkb.js";import"./move-Bzyc79vL.js";import"./index-D9U4WvIE.js";import"./index-CvALG2oX.js";import"./SearchOutlined-Bh66KhXc.js";import"./useBreakpoint-HjQEkdEA.js";import"./Pagination-Dv2YSLQ3.js";import"./Input-LTpJ6AuY.js";import"./index-B87p3I4c.js";import"./EyeOutlined-BBPXKIU8.js";import"./BadgeWrapper-D8uZ2wKG.js";import"./index-l5dW_dFo.js";import"./index-iP3EwXx5.js";import"./index-CiDxWY8X.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-BE6G2xp0.js";import"./col-DLTiGXF3.js";const A=o((()=>s((()=>import("./VideoViewer-C2qoCs6p.js")),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),{fallback:y}),U="1.8",W=e=>!!e.image,E=e=>!W(e)&&!!e.video;function H({target:o}){const{ti:s}=l(),{message:y,notification:H}=c(),[Y,z]=R("TiktokUserVideos."+o.uniqueId,[]),[J,K]=R("TiktokUserVideos.loading",!1),G=e.useRef(null),Q=t.version>=U,X=async()=>{const e="TiktokUserVideos.onReload";b(e),K(!0),z([]),y.loading({key:e,content:s({en:"Loading...",vi:"Đang tải..."}),duration:0});try{G.current&&G.current.close();const t=window.open("https://www.tiktok.com/@"+o.uniqueId,"_blank","width=800,height=600");t.blur(),window.focus(),G.current=t,y.loading({key:e,content:s({en:"Waiting tiktok...",vi:"Đang chờ tiktok..."}),duration:0}),await B(t);let a="",n=0,l=!1;for(;!l&&!t.closed;){y.loading({key:e,content:i.jsxs(i.Fragment,{children:[s({en:"Fetching videos...",vi:"Đang tải videos..."})+n,i.jsx("br",{}),i.jsx("i",{children:s({en:"Click to stop",vi:"Bấm để dừng"})})]}),duration:0,onClick:()=>{l=!0}});const c=r({secUid:o.secUid,count:35,cursor:a,coverFormat:"2"}),m="https://www.tiktok.com/api/post/item_list/?"+Object.entries(c).map((e=>e.join("="))).join("&"),u=await V({win:t,fnPath:"fetch",params:[m,{credentials:"include"}],checkAbort:()=>l}),h=I(u);console.log(h);const p=d(null==h?void 0:h.itemList);if(!p.length)break;if(n+=p.length,z((e=>[...e,...p])),!(null==h?void 0:h.hasMore))break;a=null==h?void 0:h.cursor,await T(500)}t.closed?y.warning({content:s({en:"Tiktok window closed before done",vi:"Tab tiktok bị tắt trước khi chạy xong"})}):t.close(),H.open({type:"success",message:s({en:"Fetch tiktok videos completed",vi:"Tìm videos tiktok xong"}),description:o.uniqueId+" - "+n+" videos",duration:0})}catch(t){console.log(t),H.open({type:"error",message:s({en:"Failed to fetch tiktok videos",vi:"Lỗi tìm videos tiktok"}),description:o.uniqueId+" - "+t.message,duration:0})}finally{y.destroy(e),K(!1)}},Z=e.useMemo((()=>{const e=Y.filter(W).length;return[{title:"#",dataIndex:"index",key:"index",width:50},{title:`${Y.filter(E).length} Video + ${e} Photo`,key:"video",render(e,t,o){var a;return i.jsx(u.Ribbon,{text:"Photo",color:"geekblue-inverse",style:{opacity:t.image?1:0},children:i.jsx(_,{src:(null==(a=t.image)?void 0:a.cover)||t.video.cover,fallback:t.video.cover,style:{width:180,height:200,objectFit:"cover",borderRadius:10},preview:{destroyOnHidden:!0,imageRender:t.image?()=>{var e;return i.jsx(L,{style:{maxWidth:"90vw",maxHeight:"90vh",alignItems:"center",overflowY:"auto",overflowX:"hidden",padding:10,borderRadius:10},children:i.jsx(O,{grid:{gutter:10},style:{width:"100%"},dataSource:null==(e=t.image)?void 0:e.images,renderItem:(e,t)=>i.jsx(O.Item,{children:i.jsx(_,{src:e,style:{objectFit:"cover",width:250,height:250,borderRadius:10}})}),rowKey:e=>e})})}:()=>i.jsx(A,{info:t.video,defaultVariantTitle:{en:"Best",vi:"Tốt nhất"},style:{maxWidth:"90vw",maxHeight:"90vh"}}),toolbarRender:()=>null}})})},filters:[{text:"Video",value:"video"},{text:"Photo",value:"photo"}].map((e=>({text:e.text+" ("+Y.filter((t=>"photo"===e.value&&W(t)||"video"===e.value&&E(t))).length+")",value:e.value}))),onFilter:(e,t)=>"photo"===e&&W(t)||"video"===e&&E(t),align:"center",width:180},{title:s({en:"Desc",vi:"Nội dung"}),dataIndex:"desc",key:"desc",render:(e,t,o)=>i.jsx(h.Text,{style:{maxWidth:250},children:t.desc}),width:250},{title:new Set(Y.map((e=>{var t;return null==(t=e.music)?void 0:t.title}))).size+s({en:" Music",vi:" Nhạc"}),dataIndex:"music",key:"music",render(e,t,o){const{id:a,author:s,cover:n,original:r,playUrl:d,title:l}=t.music||{};return a?i.jsxs(p,{direction:"vertical",size:3,children:[i.jsx(_,{src:n,style:{width:50,height:50,borderRadius:10}}),i.jsxs(h.Text,{children:[s," ",l," ",r," ",!!d&&i.jsx(h.Link,{href:d,target:"_blank",children:i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})})]})]}):"-"},filters:m(Y.map((e=>e.music)),"title"),onFilter:(e,t)=>{var i;return(null==(i=t.music)?void 0:i.title)===e},filterSearch:!0,width:150},{title:s({en:"Created",vi:"Ngày đăng"}),dataIndex:"createTime",key:"createTime",render:(e,t,o)=>i.jsxs(p,{direction:"vertical",size:3,children:[i.jsx(h.Text,{children:g(t.createTime)}),i.jsx(h.Text,{type:"secondary",children:v(t.createTime)})]}),sorter:(e,t)=>e.createTime-t.createTime,width:120},{title:i.jsx("i",{className:"fa-solid fa-play fa-lg"}),dataIndex:"views",key:"views",render:(e,t,i)=>j(t.stats.playCount),sorter:(e,t)=>e.stats.playCount-t.stats.playCount,width:70},{title:i.jsx("i",{className:"fa-solid fa-heart fa-lg"}),dataIndex:"heart",key:"heart",render:(e,t,i)=>j(t.stats.diggCount),sorter:(e,t)=>e.stats.diggCount-t.stats.diggCount,width:70},{title:i.jsx("i",{className:"fa-solid fa-comment fa-lg"}),dataIndex:"comments",key:"comments",render:(e,t,i)=>j(t.stats.commentCount),sorter:(e,t)=>e.stats.commentCount-t.stats.commentCount,width:70},{title:i.jsx("i",{className:"fa-solid fa-bookmark fa-lg"}),dataIndex:"collect",key:"collect",render:(e,t,i)=>j(t.stats.collectCount),sorter:(e,t)=>e.stats.collectCount-t.stats.collectCount,width:70},{title:i.jsx("i",{className:"fa-solid fa-share fa-lg"}),dataIndex:"shares",key:"shares",render:(e,t,i)=>j(t.stats.shareCount),sorter:(e,t)=>e.stats.shareCount-t.stats.shareCount,width:70},{title:i.jsx("i",{className:"fa-solid fa-clock fa-lg"}),dataIndex:"length",key:"length",render:(e,t,i)=>x(t.video.duration),sorter:(e,t)=>e.video.duration-t.video.duration,width:70},{title:s({en:"Action",vi:"Hành động"}),dataIndex:"action",key:"action",render:(e,t,o)=>i.jsx(p.Compact,{children:i.jsx(f,{title:s({en:"Open on tiktok",vi:"Mở trong tiktok"}),children:i.jsx(a,{icon:i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"}),onClick:()=>{var e;window.open(`https://www.tiktok.com/@${null==(e=t.author)?void 0:e.uniqueId}/video/${t.video.id}`,"_blank")}})})}),width:90}]}),[Y]);return i.jsx("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:Q?location.hostname.includes(".github.io")?i.jsx(w,{message:i.jsxs(i.Fragment,{children:[i.jsx(h.Text,{children:s({en:i.jsxs(i.Fragment,{children:["🚧 Please open"," ",i.jsxs("a",{href:"https://fb-aio.web.app/#/bulk-downloader",target:"_blank",children:[" ","This website"," ",i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})]})," ","to download bulk Tiktok."]}),vi:i.jsxs(i.Fragment,{children:["🚧 Vui lòng mở"," ",i.jsxs("a",{href:"https://fb-aio.web.app/#/bulk-downloader",target:"_blank",children:[" ","Trang web này"," ",i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})]})," ","để tải hàng loạt Tiktok."]})})})," ",i.jsxs("a",{href:"https://www.facebook.com/groups/fbaio/posts/1583865772268105",target:"_blank",children:[s({en:"Reason?",vi:"Lý do?"})," ",i.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})]})]}),type:"error",style:{alignSelf:"center",marginBottom:10}}):Q||(null==Y?void 0:Y.length)?i.jsxs(M,{justify:"center",gutter:[10,10],children:[i.jsx(w,{type:"info",showIcon:!0,message:s({en:'Click "Reload" button to start find videos',vi:'Bấm nút "Tải lại" để bắt đầu tìm videos'})}),i.jsx(F,{searchable:!0,selectable:!0,data:Y.map(((e,t)=>({...e,index:t+1}))),columns:Z,keyExtractor:e=>e.id,onSearchRow:(e,t)=>{var i,o;return[t.id,t.desc,null==(i=t.author)?void 0:i.nickname,null==(o=t.author)?void 0:o.uniqueId].find((t=>!!t&&k(e,t)))},renderTitle:e=>{const t=(null==e?void 0:e.length)?e:Y,r=t.filter((e=>e.video&&!e.image));return i.jsxs(i.Fragment,{children:[i.jsx(a,{type:"primary",icon:i.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:X,loading:J,children:s({en:"Reload",vi:"Tải lại"})}),i.jsx(D,{title:s({en:"Download",vi:"Tải xuống"}),data:t,options:[{key:"videos",label:r.length+" videos",onClick:e=>{(async e=>{if(!(await P()))return;const t="TiktokUserVideos:downloadVideos";b(t);const a=e.map(((e,t)=>({name:t+"_"+C(e.desc||e.video.id||e.id)+".mp4",urls:(e.video.variants||[]).map((e=>[e.source,e.urls].flat().filter(Boolean))).flat().filter(Boolean)}))).filter((e=>e.urls.length));if(!a.length)return!1;const r=await window.showDirectoryPicker({mode:"readwrite"});await r.requestPermission({writable:!0});const d=await r.getDirectoryHandle(C(null==o?void 0:o.uniqueId),{create:!0}),l=t;y.loading({key:l,content:s({en:"Downloading...",vi:"Đang tải..."}),duration:0});let c=!1,m=0,u=0;const h=Math.min(5,a.length),p=Array.from({length:h},(()=>"")),g=a.map(((e,t)=>async(t,i)=>{for(let a of e.urls)try{p[i]=N(e.name,30);const t=await n(a,!0);a!==t&&console.log("redirected",a,t);const o=await $({url:t,checkAbortFn:()=>c}),s=o.headers.get("content-type");if("video/mp4"!==s)throw new Error("Invalid content type: "+s);const r=await o.blob(),l=await d.getFileHandle(e.name,{create:!0}),u=await l.createWritable();return await u.write(r),await u.close(),m++,!0}catch(o){console.log(o,e)}return u++,!1})),{start:v,stop:j}=q(h,g,1e3),x=setInterval((()=>{y.loading({key:l,content:i.jsxs(i.Fragment,{children:[s({en:`Downloading... ${m}/${a.length}. Failed: ${u}`,vi:`Đang tải... ${m}/${a.length}. Lỗi: ${u}`}),i.jsx("br",{}),i.jsx("i",{children:s({en:"Click to stop",vi:"Bấm để dừng"})}),i.jsx("br",{}),p.map(((e,t)=>i.jsxs("div",{style:{textAlign:"left"},children:[e,i.jsx("br",{})]},t)))]}),duration:0,onClick:()=>c=!0}),c&&j()}),500);await v(),clearInterval(x),y.destroy(l),H.open({type:"success",message:s(c?{en:"Stopped download tiktok videos",vi:"Đã dừng tải video tiktok"}:{en:"Downloaded tiktok videos",vi:"Tải xong video tiktok"}),description:`${null==o?void 0:o.uniqueId} (${m}/${a.length})`,duration:0})})(e)}},{key:"formatted json",label:".json (formatted)",prepareData:e=>({fileName:(null==o?void 0:o.uniqueId)+".json",data:JSON.stringify(e.map((e=>({...e,raw:void 0,video:{...e.video,raw:void 0}}))),null,4)})},{key:"raw json",label:".json (raw)",prepareData:e=>({fileName:(null==o?void 0:o.uniqueId)+".raw.json",data:JSON.stringify(e.map((e=>e.raw)),null,4)})}]}),i.jsx(S,{text:Y.map((e=>e.desc)).join("\n")})]})}})]}):null:i.jsx(w,{message:s({vi:`Sắp có trong phiên bản v${U} (Bạn đang dùng v${t.version})`,en:`Coming soon in version v${U} (Current v${t.version})`}),type:"warning",showIcon:!0,style:{alignSelf:"center",marginBottom:10}})})}export{H as default};
