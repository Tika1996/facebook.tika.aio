const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./module-CrWglcqi.js","./index-DZEcYG8Q.js","./index-C6k8ZUm0.css","./module-CA5c4VJM.js","./VideoWithMuted-BryCN2DG.js","./StoryViewers-Ckctu5i9.js","./MyApp-DRRa55Bd.js","./Collection-DTYRwOd8.js","./index-BA5m7QhG.js","./useCacheState-D4ghBCVU.js","./react-hotkeys-hook.esm-D8zm19cE.js","./index-C0Edlh-n.js","./index-BQAhaSn9.js","./index-CEGXIRel.js","./index-KPoWFIyW.js","./dropdown-BoVCRztz.js","./Dropdown-BgvXKd3u.js","./PurePanel-Beni9Vkb.js","./move-Bzyc79vL.js","./index-B87p3I4c.js","./Input-LTpJ6AuY.js","./EyeOutlined-BBPXKIU8.js","./SearchOutlined-Bh66KhXc.js","./index-CG5dclLJ.js","./useBreakpoint-HjQEkdEA.js","./index-D9U4WvIE.js","./List-BPJoeCz4.js","./index-CvALG2oX.js","./DownOutlined-BrkIPj-I.js","./row-BgRGnxnv.js","./Pagination-Dv2YSLQ3.js","./col-DLTiGXF3.js","./index-DHhmxYJT.js","./stories-DAeaujzo.js","./index-DhxhS065.js","./useVIP-CGpIDALh.js","./sweetalert2.esm.all-BZxvatOx.js","./getIds-BE6G2xp0.js","./index-CiDxWY8X.js"])))=>i.map(i=>d[i]);
import{a$ as e,aW as i,aU as t,r as s,b1 as n,b5 as a,b2 as r,aY as o,bi as l}from"./index-DZEcYG8Q.js";import{getStoriesBucketsData as c,reactStory as d}from"./stories-DAeaujzo.js";import{u as m,a as u,t as h,T as x,c as j,e as v,f,S as g,h as p,aI as y,I as b,C as w}from"./MyApp-DRRa55Bd.js";import k from"./useCacheState-D4ghBCVU.js";import{$ as _}from"./module-CA5c4VJM.js";import{I as R}from"./index-BE0FsmaM.js";import{A as S}from"./index-DhxhS065.js";import"./EyeOutlined-BBPXKIU8.js";import"./addEventListener-C9VBchln.js";import"./useBreakpoint-HjQEkdEA.js";import"./index-C0Edlh-n.js";const E=r((()=>o((()=>import("./module-CrWglcqi.js")),__vite__mapDeps([0,1,2,3]),import.meta.url)),{fallback:w}),I=r((()=>o((()=>import("./VideoWithMuted-BryCN2DG.js")),__vite__mapDeps([4,1,2]),import.meta.url)),{fallback:b}),V=r((()=>o((()=>import("./StoryViewers-Ckctu5i9.js")),__vite__mapDeps([5,1,2,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]),import.meta.url)),{fallback:w});function T({story:r,bucketsData:b=[],index:w=0}){var _;const{ti:T,language:C}=m(),{message:L}=e.useApp(),{profile:N}=u(),F=i(t.darkMode),[A,O]=k("RecentStoryViewer.buckets."+r.bucket_id,b),[P,W]=s.useState(w),[D,B]=s.useState(!1),[M,$]=s.useState(!1),[H,K]=s.useState(!1),Y=A[P]||A[0],z=P<A.length-1,G=P>0,U=0===A.length&&!D,X=r.owner.id===(null==N?void 0:N.uid),q=s.useRef(!1);s.useEffect((()=>{J()}),[]);const J=(e=!1)=>{console.log(r),!r.bucket_id||q.current||A.length&&!e||(h("RecentStoryViewer:onClickReload"),B(!0),q.current=!0,console.log(r),c(r.bucket_id).then((e=>{e&&(console.log(r,e),O(e),W(0))})).finally((()=>{q.current=!1,B(!1)})))},Q={flex:1,width:400,maxWidth:"90vw",borderRadius:10,objectFit:"contain"},Z=(null==Y?void 0:Y.seen)?n.jsx("span",{children:"👀"}):n.jsx("i",{className:"fa fa-eye-slash",style:{color:"gray"}}),ee=X?n.jsxs(a,{type:"default",onClick:()=>$(!M),children:[n.jsx("i",{className:"fa fa-eye"})," ",null==Y?void 0:Y.view_count," ",T({vi:"Lượt xem",en:"Views"})]}):null,ie=n.jsx(n.Fragment,{children:n.jsx(x,{placement:"bottom",title:n.jsxs(n.Fragment,{children:[Z," ",f(null==Y?void 0:Y.creation_time)," ",r.owner.name,(null==Y?void 0:Y.seen)?T({en:" KNOWS you saw",vi:" BIẾT bạn đã xem"}):T({en:" DOESN'T know you saw",vi:" KHÔNG biết bạn đã xem"})]}),children:n.jsxs(j.Text,{children:[Z," ",v(null==Y?void 0:Y.creation_time)," ",T({vi:"trước",en:"ago"})," -"," ",null==Y?void 0:Y.react_count," reactions ",null==Y?void 0:Y.reaction]})})}),te=n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{position:"relative"},children:[(null==Y?void 0:Y.video)?n.jsx(I,{src:null==Y?void 0:Y.video,style:Q}):n.jsx(R,{src:null==Y?void 0:Y.image,fallback:null==Y?void 0:Y.thumbnail,style:Q}),n.jsx(g,{direction:"vertical",align:"start",style:{background:"linear-gradient(180deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%)",position:"absolute",top:0,left:0,width:"100%",paddingBottom:50,borderRadius:10},children:n.jsx("div",{style:{padding:10},children:n.jsxs(j.Link,{target:"_blank",href:p(r.owner.id),children:[n.jsx(S,{src:r.owner.avatar,size:40,style:{borderWidth:4,borderColor:"#0866FF",marginRight:10}}),n.jsx(j.Text,{style:{color:"#eee"},children:r.owner.name})]})})})]}),(null==(_=null==Y?void 0:Y.reactions)?void 0:_.length)?n.jsxs("p",{style:{marginLeft:50},children:[null==Y?void 0:Y.reactions.map((e=>e.reaction)),T({en:" sent to ",vi:" đã gửi cho "}),r.owner.name]}):null,(null==Y?void 0:Y.caption)&&n.jsx(j.Text,{children:null==Y?void 0:Y.caption})]}),se=n.jsx(a,{disabled:!G,onClick:()=>{W(P-1)},children:n.jsx("i",{className:"fa fa-chevron-left"})}),ne=n.jsx(a,{disabled:!z,onClick:()=>{W(P+1)},children:n.jsx("i",{className:"fa fa-chevron-right"})}),ae=n.jsxs(g,{direction:"vertical",children:[n.jsxs(a,{onClick:()=>K(!H),children:[n.jsx("i",{className:"fa fa-smile"})," ",T({en:"Add reactions",vi:"Thả cảm xúc"})]}),H?n.jsx("div",{style:{display:"flex",justifyContent:"center"},children:n.jsx(E,{theme:F?"dark":"light",locale:C,set:"facebook",onEmojiSelect:e=>(async i=>{const t=(await o((async()=>{const{checkVIP:e}=await import("./useVIP-CGpIDALh.js");return{checkVIP:e}}),__vite__mapDeps([35,1,2,6,36,37,19,20,21,22,38,16]),import.meta.url)).checkVIP;if(!(await t()))return;const s=null==Y?void 0:Y.id;if(!s)return;const n="RecentStoryViewer:onClickReactStory";h(n);const a=n+y();try{if(L.loading({key:a,duration:0,content:T({en:"Reacting...",vi:"Đang thả cảm xúc..."})+i}),!(await d(s,i)))throw new Error("Failed to react story");L.success({key:a,content:T({en:"React success: ",vi:"Thả cảm xúc thành công: "})+i}),O((e=>l(e,(e=>{e[P]&&e[P].reactions.push({uid:null==N?void 0:N.uid,reaction:i})}))))}catch(e){L.error({key:a,content:T({en:"React failed: ",vi:"Thả cảm xúc lỗi: "})+e.message})}})(e.native)})}):null]});return n.jsx(g,{direction:"vertical",style:{maxHeight:"100vh",maxWidth:"100vw",overflowY:"auto",overflowX:"hidden",background:F?"#222":"#eee",color:F?"white":"#111",padding:10,borderRadius:10},children:D?n.jsxs("div",{children:[n.jsx("i",{className:"fa fa-spinner fa-spin"})," ",T({en:"Loading...",vi:"Đang tải..."})]}):U?n.jsxs(g,{children:["No data",n.jsx("br",{}),n.jsx(a,{icon:n.jsx("i",{className:"fa fa-refresh"}),onClick:()=>J(!0),children:T({en:"Reload",vi:"Làm mới"})})]}):Y&&n.jsxs(n.Fragment,{children:[A.length>1&&n.jsxs(g,{children:[se,P+1+"/"+A.length,ne]}),M?n.jsxs(g,{style:{width:450,maxWidth:"90vw",overflow:"auto"},direction:"vertical",children:[ie,ee,n.jsx(V,{storyId:null==Y?void 0:Y.id})]}):n.jsxs(n.Fragment,{children:[n.jsxs(g,{direction:"vertical",children:[ie,ee,te]}),ae]})]})})}new _({data:async()=>(await fetch("https://cdn.jsdelivr.net/npm/@emoji-mart/data")).json()});export{T as default};
