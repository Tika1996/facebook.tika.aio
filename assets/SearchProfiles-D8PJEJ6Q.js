const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ProfileCard-78JF4fiM.js","./index-DZEcYG8Q.js","./index-C6k8ZUm0.css","./MyApp-DRRa55Bd.js","./index-B2BHea4N.js","./index-CiDxWY8X.js","./Dropdown-BgvXKd3u.js","./index-BE0FsmaM.js","./EyeOutlined-BBPXKIU8.js","./addEventListener-C9VBchln.js","./MyTable-D1FbPMwN.js","./index-BA5m7QhG.js","./index-DOt91uSA.js","./DownOutlined-BrkIPj-I.js","./Table-DDck-vB7.js","./List-BPJoeCz4.js","./index-BRk8JeT5.js","./index-CEGXIRel.js","./index-BQAhaSn9.js","./index-KPoWFIyW.js","./dropdown-BoVCRztz.js","./PurePanel-Beni9Vkb.js","./move-Bzyc79vL.js","./index-D9U4WvIE.js","./index-CvALG2oX.js","./SearchOutlined-Bh66KhXc.js","./useBreakpoint-HjQEkdEA.js","./Pagination-Dv2YSLQ3.js","./Input-LTpJ6AuY.js","./row-BgRGnxnv.js","./index-B87p3I4c.js","./groupMembers-DfTdAKN7.js","./getIds-BE6G2xp0.js"])))=>i.map(i=>d[i]);
import{r as e,b1 as a,bg as t,b2 as i,b5 as n,aY as r}from"./index-DZEcYG8Q.js";import{S as s}from"./Screen-1_H4V3tg.js";import o from"./ExportButton-CPuYvz9B.js";import{u as l,d as c,S as m,i as d,h,A as u,l as p,c as f,j as g,z as j,t as x,v,o as y,I as b,C as w}from"./MyApp-DRRa55Bd.js";import k from"./useCacheState-D4ghBCVU.js";import{s as _}from"./search-Dd69rUyC.js";import{s as S}from"./index-CyqwpZdp.js";import{A as I}from"./index-DhxhS065.js";import{I as C}from"./index-BE0FsmaM.js";import{P as E}from"./progress-DrPKzQLC.js";import{C as P}from"./index-B2BHea4N.js";import{U as T}from"./index-CjG_XAWm.js";import{I as U}from"./index-B87p3I4c.js";import{S as M}from"./index-D9U4WvIE.js";import"./col-DLTiGXF3.js";import"./row-BgRGnxnv.js";import"./useBreakpoint-HjQEkdEA.js";import"./useVIP-CGpIDALh.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-BE6G2xp0.js";import"./index-CiDxWY8X.js";import"./Dropdown-BgvXKd3u.js";import"./Input-LTpJ6AuY.js";import"./EyeOutlined-BBPXKIU8.js";import"./SearchOutlined-Bh66KhXc.js";import"./index-KPoWFIyW.js";import"./dropdown-BoVCRztz.js";import"./PurePanel-Beni9Vkb.js";import"./move-Bzyc79vL.js";import"./index-C0Edlh-n.js";import"./addEventListener-C9VBchln.js";import"./List-BPJoeCz4.js";import"./index-CvALG2oX.js";import"./DownOutlined-BrkIPj-I.js";function N(e){return ArrayBuffer.isView(e)&&1===e.BYTES_PER_ELEMENT}function A(e,a,t,i,n,r,s){const o=Math.max(a-1,0),l=Math.max(t-1,0),c=Math.min(a+1,i-1),m=Math.min(t+1,n-1),d=t*i+a;let h=a===o||a===c||t===l||t===m?1:0,u=0,p=0,f=0,g=0,j=0,x=0;for(let v=o;v<=c;v++)for(let n=l;n<=m;n++){if(v===a&&n===t)continue;const r=O(e,e,4*d,4*(n*i+v),!0);if(0===r){if(h++,h>2)return!1}else r<u?(u=r,f=v,g=n):r>p&&(p=r,j=v,x=n)}return 0!==u&&0!==p&&(F(r,f,g,i,n)&&F(s,f,g,i,n)||F(r,j,x,i,n)&&F(s,j,x,i,n))}function F(e,a,t,i,n){const r=Math.max(a-1,0),s=Math.max(t-1,0),o=Math.min(a+1,i-1),l=Math.min(t+1,n-1),c=e[t*i+a];let m=a===r||a===o||t===s||t===l?1:0;for(let d=r;d<=o;d++)for(let n=s;n<=l;n++)if((d!==a||n!==t)&&(m+=+(c===e[n*i+d]),m>2))return!0;return!1}function O(e,a,t,i,n){const r=e[t],s=e[t+1],o=e[t+2],l=e[t+3],c=a[i],m=a[i+1],d=a[i+2],h=a[i+3];let u=r-c,p=s-m,f=o-d;const g=l-h;if(!(u||p||f||g))return 0;if(l<255||h<255){u=(r*l-c*h-(48+t%2*159)*g)/255,p=(s*l-m*h-(48+(t/1.618033988749895|0)%2*159)*g)/255,f=(o*l-d*h-(48+(t/2.618033988749895|0)%2*159)*g)/255}const j=.29889531*u+.58662247*p+.11448223*f;if(n)return j;const x=.59597799*u-.2741761*p-.32180189*f,v=.21147017*u-.52261711*p+.31114694*f,y=.5053*j*j+.299*x*x+.1957*v*v;return j>0?-y:y}function D(e,a,t,i,n){e[a+0]=t,e[a+1]=i,e[a+2]=n,e[a+3]=255}function L(e,a,t,i){const n=255+(.29889531*e[a]+.58662247*e[a+1]+.11448223*e[a+2]-255)*t*e[a+3]/255;D(i,a,n,n,n)}const R=i((()=>r((()=>import("./ProfileCard-78JF4fiM.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url)),{fallback:b}),z=i((()=>r((()=>import("./MyTable-D1FbPMwN.js")),__vite__mapDeps([10,1,2,3,11,12,13,14,9,15,16,17,18,19,20,6,21,22,23,24,25,26,27,28,29,30,8]),import.meta.url)),{fallback:w}),{Dragger:B}=T,V={people_search:{label:{en:"Search all people",vi:"Tìm kiếm tài khoản"},icon:"fa-solid fa-user",desc:{en:"Search all people on Facebook",vi:"Tìm kiếm tất cả tài khoản trên Facebook"}},group_search:{label:{en:"Search in group",vi:"Tìm kiếm trong nhóm"},icon:"fa-solid fa-users",desc:{en:"Search members in group on Facebook",vi:"Tìm kiếm thành viên trong nhóm Facebook"}}};async function G(e,a,t){const{searchGroupMembers:i}=await r((async()=>{const{searchGroupMembers:e}=await import("./groupMembers-DfTdAKN7.js");return{searchGroupMembers:e}}),__vite__mapDeps([31,3,1,2]),import.meta.url);return(await i({groupID:a,cursor:t,search:e})).map((e=>{var a;return{uid:e.id,url:e.url,name:e.name,nickname:e.name,avatar:e.avatar,isVerified:e.isVerified,hasStory:!1,desc:(null==(a=e.signals)?void 0:a.map((e=>e.text)).join(", "))+" "+e.joinStatus,bio:e.bio,ctas:[],friendship:e.friendshipStatus,cursor:e.cursor}}))}function W(){const{ti:i}=l(),{message:b}=c(),[w,T]=k("SearchProfiles.name",""),[N,A]=k("SearchProfiles.avatarFile",null),[F,O]=k("SearchProfiles.searchMode","people_search"),[D,L]=k("SearchProfiles.resultMode",F),[W,Y]=k("SearchProfiles.groupId",""),[J,Q]=k("SearchProfiles.group",null),[$,X]=e.useState(!1),[Z,ee]=e.useState(!1),[ae,te]=e.useState([]),ie=e.useMemo((()=>N?URL.createObjectURL(N):null),[N]),ne=async e=>{try{if(!e)return;X(!0);const{getUidFromUrl:a}=await r((async()=>{const{getUidFromUrl:e}=await import("./getIds-BE6G2xp0.js");return{getUidFromUrl:e}}),__vite__mapDeps([32,1,2,3]),import.meta.url),t=await a(e);if(console.log("uid:",t),!t)throw new Error(i({en:"Cannot found group UID",vi:"Không tìm thấy UID nhóm"}));if((null==J?void 0:J.uid)===t)return;const n=await g(t);if(console.log("about:",n),n.type!==j.Group)throw new Error(i({en:"Only support group facebook, current is ",vi:"Chỉ hỗ trợ nhóm Facebook, hiện tại là "})+n.type+" ("+n.name+")");return Q(n),n}catch(a){return b.error({content:a.message}),null}finally{X(!1)}},re=async(e=!1)=>{var t,n;if(!w)return b.error({content:i({en:"Please enter account name to search",vi:"Vui lòng nhập tên tài khoản fb cần tìm"})});if(!N)return b.error({content:i({en:"Please upload avatar file to search",vi:"Vui lòng tải lên file ảnh đại diện để tìm"})});let r=J;if("group_search"===F&&!J&&(r=await ne(W),!r))return;L(F);const s="SearchProfiles:onSearch:"+F;x(s),ee(!0);const o=e?[]:[...ae],l=new Set(o.map((e=>e.uid)));let c=(null==(t=o[o.length-1])?void 0:t.cursor)||"",m=!1;const d=i("people_search"===F?{en:"Searching profiles...",vi:"Đang tìm kiếm tài khoản..."}:{en:"Searching members...",vi:"Đang tìm kiếm thành viên..."});b.loading({key:s,duration:0,content:d});const h=await q(N);for(;!m;){const e="people_search"===F?await _({name:w,cursor:c}):await G(w,r.uid,c);console.log("res",e);let t=0;for(const a of e){if(l.has(a.uid))continue;l.add(a.uid);let e=0,i=S.compareTwoStrings(w,a.name);const n=await K(a.avatar);e=await H(h,n),o.push({...a,index:o.length,name_similarity:Number((100*i).toFixed(1)),avatar_similarity:Number(e.toFixed(1))}),t++}b.loading({key:s,duration:0,content:a.jsxs(a.Fragment,{children:[d+" ("+o.length+")",a.jsx("br",{}),a.jsx("i",{children:i({en:"Click to stop",vi:"Nhấn để dừng"})})]}),onClick:()=>{m=!0,b.loading({key:s+"-stop",content:i({en:"Stopping...",vi:"Đang dừng..."}),duration:0})}}),t?(te([...o]),c=(null==(n=o[o.length-1])?void 0:n.cursor)||"",await v(2e3,(e=>(b.loading({key:s+"-sleep",duration:0,content:i({en:"Waiting...",vi:"Đang chờ..."})+" "+~~(e/1e3)+"s"}),m))),b.destroy(s+"-sleep")):m=!0}b.destroy(s+"-stop"),b.success({key:s,content:i({en:"Stopped searching profiles",vi:"Đã dừng tìm kiếm tài khoản"})}),ee(!1)},se=[{title:"#",dataIndex:"index",key:"index",width:50},{title:"Profile",dataIndex:"name",key:"name",render:(e,t,i)=>a.jsxs(m,{style:{maxWidth:300},children:[a.jsx(I,{shape:"square",src:a.jsx(C,{src:d(t.uid),fallback:t.avatar}),size:70}),a.jsxs(m,{direction:"vertical",size:0,children:[a.jsx("a",{href:t.url||h(t.uid),target:"_blank",children:a.jsx("b",{children:t.nickname||t.name})}),a.jsx("span",{style:{opacity:.5},children:t.uid})]})]})},{title:i({en:"Name match",vi:"Giống tên"}),dataIndex:"name_similarity",key:"name_similarity",render:(e,t,i)=>a.jsx(E,{size:"small",percent:e}),sorter:(e,a)=>e.name_similarity-a.name_similarity,filters:[{text:i({en:"Match 100%",vi:"Giống 100%"})+" ("+ae.filter((e=>100===e.name_similarity)).length+")",value:"match"},{text:i({en:"No match",vi:"Không giống"})+" ("+ae.filter((e=>100!==e.name_similarity)).length+")",value:"no_match"}],onFilter:(e,a)=>"match"===e?100===a.name_similarity:"no_match"!==e||100!==a.name_similarity,width:150},{title:i({en:"Avatar match",vi:"Giống avatar"}),dataIndex:"avatar_similarity",key:"avatar_similarity",render:(e,t,i)=>a.jsx(E,{size:"small",percent:e}),sorter:(e,a)=>e.avatar_similarity-a.avatar_similarity,rangeFilter:{getValue:e=>e.avatar_similarity},width:150},{title:i({en:"Bio",vi:"Bio"}),dataIndex:"bio",key:"bio",width:300},{title:i({en:"Description",vi:"Mô tả"}),dataIndex:"desc",key:"desc",width:300},{title:i({en:"Friendship",vi:"Quan hệ"}),dataIndex:"friendship",key:"friendship",width:120}];return a.jsx(s,{title:i({en:"Search Facebook account",vi:"Tìm tài khoản Facebook"}),mode:"center",children:a.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10},children:[a.jsx(u,{message:i({en:"Find facebook account when known name and avatar",vi:"Tìm tài khoản Facebook khi biết Tên và Ảnh đại diện"}),showIcon:!0,type:"info"}),a.jsx(t,{expandIconPosition:"right",accordion:!0,items:[{key:"1",label:i({en:"🔎 How to use?",vi:"🔎 Cách sử dụng?"}),children:a.jsxs("div",{children:[a.jsxs("ul",{children:[a.jsxs("li",{children:[a.jsx("i",{className:"fa-solid fa-user"})," ",i({en:'Enter Name and Upload avatar. Then click "Search" button.',vi:'Nhập Tên và Tải lên ảnh đại diện. Sau đó bấm "Tìm" để tìm.'})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fa-solid fa-plug"})," ",i({en:"FB AIO will call facebook API to search by name",vi:"FB AIO sẽ gọi API facebook để tìm kiếm theo tên"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fa-solid fa-image"})," ",i({vi:"Đồng thời dùng thuật toán so sánh ảnh, để tìm ảnh đại diện giống nhất",en:"Also use image comparison algorithm, to find the most similar avatar"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fa-solid fa-sort"})," ",i({vi:"Bạn có thể sắp xếp/lọc theo từng cột dữ liệu, giúp tăng tốc tìm kiếm",en:"You can sort/filter by each column data, to speed up search"})]})]}),a.jsxs("a",{href:"https://www.facebook.com/groups/fbaio/posts/1726695344651813",target:"_blank",children:[i({en:"Read more",vi:"Đọc thêm"})," ",a.jsx("i",{className:"fa-solid fa-arrow-up-right-from-square"})]})]})}]}),a.jsx(P,{children:a.jsxs(m,{direction:"vertical",align:"center",children:[a.jsx(B,{accept:"image/*",beforeUpload:e=>(console.log("file:",e),A(e),!1),maxCount:1,fileList:N?[{uid:N.name,name:p(N.name,30),url:ie}]:[],onRemove:()=>A(null),disabled:Z,children:N?a.jsx(C,{src:ie,width:100,height:100,preview:!1}):a.jsxs(m,{direction:"vertical",align:"center",children:[a.jsx("i",{className:"fa-solid fa-image fa-3x"}),a.jsx(f.Text,{type:"secondary",children:i({en:"Upload avatar",vi:"Tải lên avatar"})})]})}),a.jsx(U,{size:"large",value:w,onChange:e=>T(e.target.value),placeholder:i({en:"Enter account name",vi:"Nhập tên tài khoản cần tìm"}),allowClear:!0,prefix:a.jsx("i",{className:"fa-brands fa-facebook",style:{paddingRight:5}}),disabled:Z,style:{maxWidth:300}}),a.jsx(M,{options:Object.entries(V).map((([e,t])=>({label:a.jsxs(m,{size:3,children:[a.jsx("i",{className:t.icon})," ",i(t.label)]}),value:e}))),optionRender:e=>{const t=V[e.value];return a.jsxs(m,{direction:"vertical",size:3,children:[a.jsxs(m,{children:[a.jsx("i",{className:t.icon}),i(t.label)]}),a.jsx(f.Text,{type:"secondary",children:i(t.desc)})]})},popupMatchSelectWidth:!1,value:F,onChange:O,disabled:Z}),"group_search"===F&&a.jsxs(m,{direction:"vertical",size:10,children:[a.jsx(U.Search,{value:W,onChange:e=>Y(e.target.value),placeholder:i({en:"Enter group URL/UID",vi:"Nhập URL/UID nhóm cần tìm"}),onSearch:ne,loading:$,allowClear:!0,enterButton:a.jsx("i",{className:"fa-solid fa-magnifying-glass"}),disabled:Z}),J&&a.jsx(R,{about:J,onClose:()=>Q(null)})]})]})}),a.jsxs(m,{children:[a.jsx(n,{type:"primary",size:"large",icon:a.jsx("i",{className:"fa-solid fa-magnifying-glass"}),onClick:()=>re(!0),loading:Z,children:ae.length>0?i({en:"Search again",vi:"Tìm lại"}):i({en:"Search",vi:"Tìm"})}),ae.length>0&&D===F&&a.jsx(n,{size:"large",icon:a.jsx("i",{className:"fa-solid fa-play"}),onClick:()=>re(!1),loading:Z,children:i({en:"Continue",vi:"Tiếp tục"})})]}),ae.length>0&&a.jsx(z,{searchable:!0,selectable:!0,columns:se,data:ae,renderTitle:e=>{const t=(null==e?void 0:e.length)?e:ae;return a.jsx(m,{children:a.jsx(o,{data:t,options:[{key:"json",label:".json",prepareData:e=>({data:JSON.stringify(e,null,4),fileName:w+"_search_profiles.json"})},{key:"csv",label:".csv",prepareData:e=>({data:y(e),fileName:w+"_search_profiles.csv"})}]})})},keyExtractor:e=>e.uid})]})})}const q=e=>new Promise(((a,t)=>{const i=new window.Image;i.onload=()=>a(i),i.onerror=t,i.src=URL.createObjectURL(e)})),K=e=>new Promise(((a,t)=>{const i=new window.Image;i.crossOrigin="anonymous",i.onload=()=>a(i),i.onerror=t,i.src=e})),Y=(e,a,t)=>{const i=document.createElement("canvas");i.width=a,i.height=t;const n=i.getContext("2d");return n.drawImage(e,0,0,a,t),n.getImageData(0,0,a,t)},H=async(e,a)=>{try{const t=128,i=Y(e,t,t),n=Y(a,t,t),r=new Uint8ClampedArray(t*t*4),s=function(e,a,t,i,n,r={}){const{threshold:s=.1,alpha:o=.1,aaColor:l=[255,255,0],diffColor:c=[255,0,0],includeAA:m,diffColorAlt:d,diffMask:h}=r;if(!N(e)||!N(a)||t&&!N(t))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(e.length!==a.length||t&&t.length!==e.length)throw new Error("Image sizes do not match.");if(e.length!==i*n*4)throw new Error("Image data size does not match width/height.");const u=i*n,p=new Uint32Array(e.buffer,e.byteOffset,u),f=new Uint32Array(a.buffer,a.byteOffset,u);let g=!0;for(let E=0;E<u;E++)if(p[E]!==f[E]){g=!1;break}if(g){if(t&&!h)for(let a=0;a<u;a++)L(e,4*a,o,t);return 0}const j=35215*s*s,[x,v,y]=l,[b,w,k]=c,[_,S,I]=d||c;let C=0;for(let E=0;E<n;E++)for(let r=0;r<i;r++){const s=E*i+r,l=4*s,c=p[s]===f[s]?0:O(e,a,l,l,!1);if(Math.abs(c)>j){const s=A(e,r,E,i,n,p,f)||A(a,r,E,i,n,f,p);!m&&s?t&&!h&&D(t,l,x,v,y):(t&&(c<0?D(t,l,_,S,I):D(t,l,b,w,k)),C++)}else t&&!h&&L(e,l,o,t)}return C}(i.data,n.data,r,t,t,{threshold:.2,includeAA:!1}),o=t*t,l=(o-s)/o*100;return Math.max(0,Math.min(100,l))}catch(t){return console.warn("Image comparison failed:",t),0}};export{W as default};
