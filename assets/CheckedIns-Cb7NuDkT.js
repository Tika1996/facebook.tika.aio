const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./MyApp-DRRa55Bd.js","./index-DZEcYG8Q.js","./index-C6k8ZUm0.css"])))=>i.map(i=>d[i]);
import{aY as e,a$ as a,bc as i,r as t,b1 as l,b5 as n,bk as o}from"./index-DZEcYG8Q.js";import{aA as r,y as s,u as d,t as c,S as p,c as m,T as u,A as v,o as g}from"./MyApp-DRRa55Bd.js";import{u as h}from"./useForceStop-tD0KGOJD.js";import j from"./MyTable-D1FbPMwN.js";import f from"./ExportButton-CPuYvz9B.js";import x,{getCacheByKey as k}from"./useCacheState-D4ghBCVU.js";import{I as y}from"./index-BE0FsmaM.js";import"./index-BA5m7QhG.js";import"./index-DOt91uSA.js";import"./DownOutlined-BrkIPj-I.js";import"./Table-DDck-vB7.js";import"./addEventListener-C9VBchln.js";import"./List-BPJoeCz4.js";import"./index-BRk8JeT5.js";import"./index-CEGXIRel.js";import"./index-BQAhaSn9.js";import"./index-KPoWFIyW.js";import"./dropdown-BoVCRztz.js";import"./Dropdown-BgvXKd3u.js";import"./PurePanel-Beni9Vkb.js";import"./move-Bzyc79vL.js";import"./index-D9U4WvIE.js";import"./index-CvALG2oX.js";import"./SearchOutlined-Bh66KhXc.js";import"./useBreakpoint-HjQEkdEA.js";import"./Pagination-Dv2YSLQ3.js";import"./Input-LTpJ6AuY.js";import"./row-BgRGnxnv.js";import"./index-B87p3I4c.js";import"./EyeOutlined-BBPXKIU8.js";import"./useVIP-CGpIDALh.js";import"./sweetalert2.esm.all-BZxvatOx.js";import"./getIds-BE6G2xp0.js";import"./index-CiDxWY8X.js";async function w({uid:a="",cursor:i=""}){const t=await r(a,"places_recent"),l=await s({fb_api_req_friendly_name:"ProfileCometAppCollectionListRendererPaginationQuery",variables:{cursor:i,count:8,scale:2,search:null,id:t},doc_id:"25969811035995761"}),{parseSafe:n}=await e((async()=>{const{parseSafe:e}=await import("./MyApp-DRRa55Bd.js").then((e=>e.a_));return{parseSafe:e}}),__vite__mapDeps([0,1,2]),import.meta.url),o=n(l),{findDataObject:d}=await e((async()=>{const{findDataObject:e}=await import("./MyApp-DRRa55Bd.js").then((e=>e.b0));return{findDataObject:e}}),__vite__mapDeps([0,1,2]),import.meta.url),{edges:c=[],page_info:p={}}=d(o);return c.map((e=>{var a,i,t,l,n,o,r,s,d,c,m,u,v,g,h,j,f,x;return{id:null==(a=null==e?void 0:e.node)?void 0:a.id,pageId:null==(t=null==(i=null==e?void 0:e.node)?void 0:i.node)?void 0:t.id,pageName:null==(n=null==(l=null==e?void 0:e.node)?void 0:l.title)?void 0:n.text,place:null==(d=null==(s=null==(r=null==(o=null==e?void 0:e.node)?void 0:o.subtitle_text)?void 0:r.text)?void 0:s.split("\n"))?void 0:d[0],image:null==(m=null==(c=null==e?void 0:e.node)?void 0:c.image)?void 0:m.uri,url:(null==(u=null==e?void 0:e.node)?void 0:u.url)||(null==(g=null==(v=null==e?void 0:e.node)?void 0:v.node)?void 0:g.url),timeString:null==(x=null==(f=null==(j=null==(h=null==e?void 0:e.node)?void 0:h.subtitle_text)?void 0:j.text)?void 0:f.split("\n"))?void 0:x[1],cursor:(null==e?void 0:e.cursor)||(null==p?void 0:p.end_cursor)}}))}function _({target:e}){const{ti:r}=d(),{message:s}=a.useApp(),_=i(),b=h(),[I,S]=t.useState(!1),[C,N]=x("CheckedIns.data."+(null==e?void 0:e.id),[]),P=t.useMemo((()=>{const e=new Map,a=new Map;return C.forEach((i=>{e.has(i.place)||e.set(i.place,i),a.has(i.pageId)||a.set(i.pageId,i)})),{allPlaces:Array.from(e.values()),allPages:Array.from(a.values())}}),[C]);t.useEffect((()=>{var a;(null==e?void 0:e.id)&&D(!(null==(a=k("CheckedIns.data."+(null==e?void 0:e.id)))?void 0:a.length))}),[null==e?void 0:e.id]);const D=async(a=!1)=>{var i,t;if(!(null==e?void 0:e.id))return;const l=b.start();let n=[...a?[]:k("CheckedIns.data."+(null==e?void 0:e.id))||[]],o=(null==(i=n[n.length-1])?void 0:i.cursor)||"";c("CheckedIns:onReload"),S(!0);try{for(;!l.value();){const a=await w({uid:e.id,cursor:o});if(!(null==a?void 0:a.length))break;o=null==(t=a[a.length-1])?void 0:t.cursor,n=[...n,...a].map(((e,a)=>({...e,recent:a}))),N(n)}}catch(d){s.error({content:r({en:"Error: ",vi:"Lỗi: "})+d.message})}finally{N(n),S(!1)}},A=[{title:"#",dataIndex:"recent",key:"recent",render:(e,a,i)=>(a.recent||0)+1,sorter:(e,a)=>e.recent-a.recent,width:60},{title:r({en:"Cover",vi:"Ảnh"}),key:"cover",dataIndex:"image",render:(e,a,i)=>l.jsx(y,{src:a.image,style:{width:120,height:120,objectFit:"contain"}}),width:120},{title:P.allPages.length+" "+r({en:"Page",vi:"Trang"}),key:"name",dataIndex:"name",sorter:(e,a)=>e.pageName.localeCompare(a.pageName),render:(e,a,i)=>l.jsxs(p,{direction:"vertical",style:{maxWidth:250},children:[l.jsx(m.Link,{href:a.url,target:"_blank",children:l.jsx("b",{children:a.pageName})}),l.jsx("span",{style:{opacity:.6},children:a.pageId})]}),filters:P.allPages.map((e=>{let a=C.filter((a=>a.pageId===e.pageId)).length;return{count:a,value:e.pageId,text:e.pageName+" ("+a+")"}})).sort(((e,a)=>a.count-e.count)),onFilter:(e,a)=>a.pageId==e,filterSearch:!0},{title:P.allPlaces.length+" "+r({en:"Place",vi:"Địa điểm"}),key:"place",dataIndex:"place",sorter:(e,a)=>e.place.localeCompare(a.place),filters:P.allPlaces.map((e=>{let a=C.filter((a=>a.place===e.place)).length;return{count:a,value:e.place,text:e.place+" ("+a+")"}})).sort(((e,a)=>a.count-e.count)),onFilter:(e,a)=>a.place==e,filterSearch:!0,width:200},{title:r({en:"Time",vi:"Thời gian"}),key:"timeString",dataIndex:"timeString",sorter:(e,a)=>e.timeString.localeCompare(a.timeString),width:250},{title:r({en:"Actions",vi:"Hành động"}),key:"actions",render:(e,a,i)=>l.jsxs(p.Compact,{children:[l.jsx(u,{title:r({en:"Show map",vi:"Xem bản đồ"}),children:l.jsx(n,{type:"default",onClick:()=>{window.open("https://www.google.com/maps/search/"+a.pageName,"_blank")},icon:l.jsx("i",{className:"fa-solid fa-location-dot"})})}),l.jsx(u,{title:r({en:"Bulk Downloader",vi:"Tải hàng loạt"}),children:l.jsx(n,{type:"default",onClick:()=>{return e=a.pageId,void _("/bulk-downloader",{state:{targetId:e,platform:o.Facebook}});var e},icon:l.jsx("i",{className:"fa-solid fa-download"})})})]}),width:100,align:"end"}];return l.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%"},children:[l.jsx(v,{type:"success",showIcon:!0,message:r({en:`Checked in ${C.length} times`,vi:`Đã check in ${C.length} lần`}),style:{alignSelf:"center",marginBottom:10}}),l.jsx(j,{columns:A,data:C,keyExtractor:e=>e.id,searchable:!0,pageSize:3,renderTitle:a=>l.jsxs(l.Fragment,{children:[l.jsx(n,{disabled:I,type:"primary",icon:I?l.jsx("i",{className:"fa-solid fa-rotate-right fa-spin"}):l.jsx("i",{className:"fa-solid fa-rotate-right"}),onClick:()=>D(!0),children:r({en:"Reload",vi:"Tải lại"})}),l.jsx(f,{data:a.length?a:C,options:[{key:"id",label:".txt (page id)",prepareData:a=>({fileName:(null==e?void 0:e.name)+"_check_in_id.txt",data:a.map((e=>e.pageId)).join("\n")})},{key:"id_name",label:".csv (page id+name)",prepareData:a=>({fileName:(null==e?void 0:e.name)+"_check_in_id_name.csv",data:g(a.map((e=>({page:e.pageId,name:e.pageName,place:e.place}))))})},{key:"json",label:".json",prepareData:a=>({fileName:(null==e?void 0:e.name)+"_check_in.json",data:JSON.stringify(a,null,4)})},{key:"csv",label:".csv",prepareData:a=>({fileName:(null==e?void 0:e.name)+"_check_in.csv",data:g(a)})}]}),l.jsx(n,{onClick:()=>{var a;(null==(a=null==e?void 0:e.url)?void 0:a.includes("?id="))?window.open((null==e?void 0:e.url)+"&sk=map","_blank"):window.open((null==e?void 0:e.url)+"/map","_blank")},icon:l.jsx("i",{className:"fa fa-external-link-alt"}),children:r({vi:"Xem trên Facebook",en:"View on Facebook"})},"view-fb")]})})]})}export{_ as default};
