const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./StoryViewers-Ckctu5i9.js","./index-DZEcYG8Q.js","./index-C6k8ZUm0.css","./MyApp-DRRa55Bd.js","./Collection-DTYRwOd8.js","./index-BA5m7QhG.js","./useCacheState-D4ghBCVU.js","./react-hotkeys-hook.esm-D8zm19cE.js","./index-C0Edlh-n.js","./index-BQAhaSn9.js","./index-CEGXIRel.js","./index-KPoWFIyW.js","./dropdown-BoVCRztz.js","./Dropdown-BgvXKd3u.js","./PurePanel-Beni9Vkb.js","./move-Bzyc79vL.js","./index-B87p3I4c.js","./Input-LTpJ6AuY.js","./EyeOutlined-BBPXKIU8.js","./SearchOutlined-Bh66KhXc.js","./index-CG5dclLJ.js","./useBreakpoint-HjQEkdEA.js","./index-D9U4WvIE.js","./List-BPJoeCz4.js","./index-CvALG2oX.js","./DownOutlined-BrkIPj-I.js","./row-BgRGnxnv.js","./Pagination-Dv2YSLQ3.js","./col-DLTiGXF3.js","./index-DHhmxYJT.js","./stories-DAeaujzo.js","./index-DhxhS065.js","./VideoWithMuted-BryCN2DG.js"])))=>i.map(i=>d[i]);
import{a$ as e,aW as i,aU as t,r as s,b1 as r,b2 as a,b5 as o,aY as n}from"./index-DZEcYG8Q.js";import{u as l,S as c,c as d,f as x,h,i as m,I as j}from"./MyApp-DRRa55Bd.js";import u from"./useCacheState-D4ghBCVU.js";import{getArchivedStoriesContent as f}from"./stories-DAeaujzo.js";import{I as p}from"./index-BE0FsmaM.js";import{A as y}from"./index-DhxhS065.js";import{T as g}from"./index-CiDxWY8X.js";import"./EyeOutlined-BBPXKIU8.js";import"./addEventListener-C9VBchln.js";import"./useBreakpoint-HjQEkdEA.js";import"./index-C0Edlh-n.js";import"./Dropdown-BgvXKd3u.js";const v=a((()=>n((()=>import("./StoryViewers-Ckctu5i9.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),import.meta.url)),{fallback:j}),b=a((()=>n((()=>import("./VideoWithMuted-BryCN2DG.js")),__vite__mapDeps([32,1,2]),import.meta.url)),{fallback:j});function w({story:a}){const{ti:n}=l(),{message:j}=e.useApp(),w=i(t.darkMode),[_,k]=u("ArchivedStoryViewer.stories."+a.creation_time,[]),[T,A]=u("ArchivedStoryViewer.viewingIndex."+a.id,0),[R,N]=s.useState(!1),I=_[T]||_[0],V=I?Object.values(I.viewer_count).reduce(((e,i)=>e+i),0):0,E=I?I.reactions.reduce(((e,i)=>e+i.count),0):0,L=T<_.length-1,S=T>0,O=0===_.length&&!R,$=s.useRef(!1);s.useEffect((()=>{(null==_?void 0:_.length)||!a.creation_time||$.current||(N(!0),$.current=!0,f({creationTime:a.creation_time}).then((e=>{if(e){const i=e.findIndex((e=>e.id===a.id));k(e),A(i)}})).catch((e=>j.error(n({en:"Error: ",vi:"Lỗi: "}))+e.message)).finally((()=>{N(!1),$.current=!1})))}),[]);const D={height:"70vh",width:"calc(70vh * 9 / 16)"},C=s.useRef(null),F=I?[{key:"story",label:r.jsxs(d.Text,{children:[r.jsx("i",{className:"fa fa-play"})," Play"]}),children:r.jsxs(c,{direction:"vertical",style:{position:"relative"},children:[I.video?r.jsx(b,{src:I.video,style:{...D,borderRadius:10,objectFit:"contain"}}):I.image_background?r.jsxs(c,{direction:"vertical",style:{position:"relative"},children:[r.jsx(p,{src:I.image_background,preview:!1,style:{...D,borderRadius:10,objectFit:"contain"}}),r.jsx(p,{src:I.image,style:{...D,borderRadius:10,objectFit:"contain",position:"absolute",bottom:0,left:0,transform:"translate(-50%, 0)",opacity:.5}})]}):r.jsx(p,{src:I.image,style:{...D,borderRadius:10,objectFit:"contain"}}),r.jsx(c,{direction:"vertical",align:"start",style:{background:"linear-gradient(180deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%)",position:"absolute",top:0,left:0,padding:10,width:"100%",paddingBottom:"50px",borderRadius:10},children:[I.comment_count?{icon:r.jsx("i",{className:"fa-solid fa-message"}),text:I.comment_count}:null,I.music?{icon:r.jsx("i",{className:"fa-solid fa-music"}),text:I.music}:null].filter(Boolean).map(((e,i)=>e&&r.jsxs(d.Text,{style:{color:"#eee",textAlign:"left"},children:[e.icon," ",e.text]},"story-statistic-"+i)))})]})},{key:"viewer",label:r.jsxs(d.Text,{children:[r.jsx("i",{className:"fa fa-eye"})," ",V," "]}),children:r.jsxs(c,{direction:"vertical",style:{...D,width:450,overflowY:"auto",overflowX:"hidden",textAlign:"left",position:"relative"},children:[r.jsxs(d.Text,{children:[n({en:"Views",vi:"Lượt xem"}),":"]}),r.jsx("ul",{children:Object.entries(I.viewer_count).map((([e,i])=>r.jsx("li",{children:r.jsxs(d.Text,{style:{color:"#eee"},children:[e,": ",i]})},"story-viewer-"+e)))}),r.jsx(c,{direction:"horizontal",style:{display:"flex",padding:10,alignItems:"center"},children:r.jsxs(d.Text,{style:{textDecoration:"underline"},children:[n({en:"Created date",vi:"Ngày đăng"}),r.jsx(d.Text,{style:{position:"absolute",right:10},children:x(new Date(I.created_at))})]})}),r.jsx(v,{storyId:I.id,initialViewers:I.viewers})]})},{key:"reactions",label:r.jsxs(d.Text,{children:[r.jsx("i",{className:"fa fa-heart"})," ",E," "]}),children:r.jsxs(c,{direction:"vertical",style:{overflowY:"auto",...D},align:"start",children:[r.jsxs(d.Text,{children:[n({en:"Reactions",vi:"Lượt thích"}),":"]}),I.reactions.map(((e,i)=>r.jsxs(d.Link,{href:h(e.uid),style:{padding:"0 5px 5px",display:"block"},target:"_blank",children:[r.jsx(y,{src:m(e.uid,50),size:35}),r.jsx(d.Text,{style:{color:"#eee",textAlign:"left"},children:` ${e.count} ${e.reactions}`},"story-reaction-"+i)]},"story-reaction-"+i)))]})}]:[];return r.jsxs(c,{direction:"vertical",style:{maxHeight:"100vh",overflowY:"auto",overflowX:"hidden",minWidth:D.width,minHeight:D.height,background:w?"#222":"#eee",color:w?"white":"#111",padding:10,borderRadius:10},ref:C,children:[r.jsxs(d.Text,{children:["Archived Story Viewer"," ",R?r.jsx("i",{className:"fa fa-spinner fa-spin"}):`(${T+1}/${_.length})`]}),O&&r.jsx("div",{children:"No data"}),I&&r.jsxs(c,{children:[r.jsx(o,{disabled:!S,onClick:()=>{A(T-1)},children:r.jsx("i",{className:"fa fa-chevron-left"})}),r.jsx(g,{defaultActiveKey:"story",items:F}),r.jsx(o,{disabled:!L,onClick:()=>{A(T+1)},children:r.jsx("i",{className:"fa fa-chevron-right"})})]})]})}export{w as default};
