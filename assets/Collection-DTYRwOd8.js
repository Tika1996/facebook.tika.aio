const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./MySwal-DffQNiol.js","./sweetalert2.esm.all-BZxvatOx.js","./index-DZEcYG8Q.js","./index-C6k8ZUm0.css","./useVIP-CGpIDALh.js","./MyApp-DRRa55Bd.js","./getIds-BE6G2xp0.js","./index-B87p3I4c.js","./Input-LTpJ6AuY.js","./EyeOutlined-BBPXKIU8.js","./SearchOutlined-Bh66KhXc.js","./index-CiDxWY8X.js","./Dropdown-BgvXKd3u.js","./file-download-pLw6ZM0z.js"])))=>i.map(i=>d[i]);
import{r as e,b1 as n,b5 as t,aY as i,cf as o,cg as l,ch as s}from"./index-DZEcYG8Q.js";import{a as r,b as a}from"./index-BA5m7QhG.js";import{u as d,d as c,t as h,aK as u,S as m,c as f,b as g,T as x,ah as j,aL as p,aM as v}from"./MyApp-DRRa55Bd.js";import w,{getCacheByKey as y}from"./useCacheState-D4ghBCVU.js";import{u as b}from"./react-hotkeys-hook.esm-D8zm19cE.js";import{P as k}from"./index-C0Edlh-n.js";import{a as C}from"./index-BQAhaSn9.js";import{D}from"./index-KPoWFIyW.js";import{I as T}from"./index-B87p3I4c.js";import{L as I}from"./index-CG5dclLJ.js";import{R as $}from"./row-BgRGnxnv.js";import{D as _}from"./index-DHhmxYJT.js";import"./index-CEGXIRel.js";import"./dropdown-BoVCRztz.js";import"./Dropdown-BgvXKd3u.js";import"./PurePanel-Beni9Vkb.js";import"./move-Bzyc79vL.js";import"./Input-LTpJ6AuY.js";import"./EyeOutlined-BBPXKIU8.js";import"./SearchOutlined-Bh66KhXc.js";import"./useBreakpoint-HjQEkdEA.js";import"./index-D9U4WvIE.js";import"./List-BPJoeCz4.js";import"./index-CvALG2oX.js";import"./DownOutlined-BrkIPj-I.js";import"./Pagination-Dv2YSLQ3.js";import"./col-DLTiGXF3.js";var P=(e=>(e.File="file",e.Link="link",e.JSON="json",e))(P||{}),S=(e=>(e.Grid="grid",e.Vertical="vertical",e))(S||{});function B({collectionName:S,renderItem:B,fetchNext:N,rowKey:E,downloadItem:L,getItemCursor:A,initialData:O=[],downloadThreads:F=5,downloadOptions:M=[],displayType:V="grid",headerButtons:R=()=>null,header:q=()=>null,once:z=!1,all:H=!1,stop:K=!1,showPagination:W=!1,hideLoadMore:G=!1,pageSize:J=20,searchPlaceholder:X=()=>({en:"Search",vi:"Tìm kiếm"}),onSearch:Q,centerItems:Y=!0}){const{ti:U}=d(),{message:Z,notification:ee}=c(),{isIntersecting:ne,ref:te}=r(),[ie,oe]=e.useState(!1),[le,se]=w(`Collection.${S}.hasMore`,!0),[re,ae]=w(`Collection.${S}.data`,O),[de,ce]=w(`Collection.${S}.pageIndex`,1),[he,ue]=w(`Collection.${S}.search`,""),[me,fe]=w(`Collection.${S}.selected`,[]),[ge,xe]=w(`Collection.${S}.selectMode`,!1),[je,pe]=w(`Collection.${S}.downloaded`,{});b(["shift"],(()=>{L&&xe((e=>!e))}));const ve=e.useMemo((()=>he&&Q?re.filter((e=>Q(he,e))):re),[re,he,Q]);e.useEffect((()=>{let e=re.length,n=Math.ceil(e/20);de>n&&ce(n)}),[re,de]),e.useEffect((()=>{re.length||ye(!1)}),[S]),e.useEffect((()=>{O&&!N&&ae(O)}),[O,N]);const we=(!re.length||ne||H)&&le&&!he&&!K&&N;a((()=>{we&&ke()}),1e3),e.useEffect((()=>{we&&ke()}),[we]);const ye=(e=!1)=>{e&&h("Collection:reload");const n=e?[]:y("Collection.data."+S)||[];ae(n),fe([]),ke(n)},be=e.useRef(!1),ke=async(e=re)=>{if(be.current)return;be.current=!0,oe(!0);const n=await(null==N?void 0:N(e));console.log(S,n);let t=!1;if(null==n?void 0:n.length){const i=u(e,n,E);if(se(!z&&i.length>0),i.length){const n=[...e,...i];ae(n),t=!0}}else 0===(null==n?void 0:n.length)&&se(!1);t||e.length||Z.info(U({en:"No data found",vi:"Không có dữ liệu"})+": "+S),be.current=!1,oe(!1)},Ce=e.useCallback(((e,i)=>{const o=me.indexOf(e),l=o>=0,s=je[E(e)],r={position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",background:l||s?"#000a":"#0002"};return n.jsxs("div",{style:{position:"relative",flexGrow:1,height:"100%"},children:[i<re.length-1?B(e,i,ae):n.jsx(m,{ref:te,children:B(e,i,ae)}),ge?n.jsx(t,{type:"primary",style:r,className:"scale-on-hover",onClick:()=>{fe(l?n=>n.filter((n=>n!==e)):n=>[...n,e])},children:l?n.jsx("i",{className:"fa-solid fa-5x",children:o+1}):s?n.jsx("i",{className:"fa-solid fa-check fa-5x"}):n.jsx("i",{className:"fa-solid fa-square  fa-5x",style:{color:"#fff7"}})}):s?n.jsx("div",{style:{...r,display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:"none",background:"#0006"},children:n.jsx("i",{className:"fa-solid fa-check fa-5x",style:{color:"white"}})}):null]},"select_container_"+E(e))}),[re,me,je,E,ge,B,te]),De=async({fromCursor:e,downloadType:r,startIndex:a=0}={})=>{var d;if(!L)return;if(!("showDirectoryPicker"in window)&&"file"===r){return(await i((async()=>{const{default:e}=await import("./MySwal-DffQNiol.js");return{default:e}}),__vite__mapDeps([0,1,2,3]),import.meta.url)).default.fire({icon:"error",title:U({en:"Browser not supported",vi:"Trình duyệt không hỗ trợ"}),html:n.jsxs("div",{children:[U({en:"File saver API not supported in this browser. Please use newest version of Edge or Chrome. (window.showDirectoryPicker)",vi:"Trình duyệt này không hỗ trợ API lưu file (window.showDirectoryPicker). Vui lòng sử dụng Edge hoặc Chrome bản mới nhất"}),n.jsx("br",{}),n.jsx("hr",{}),U({en:"✅ How to enable file system access API?",vi:"✅ Cách bật API lưu file?"}),n.jsx("br",{}),n.jsx("ul",{children:n.jsxs("li",{children:[U({en:"Brave Browser",vi:"Trình duyệt Brave"}),":"," ",n.jsx("code",{style:{fontSize:"0.9em"},children:"brave://flags/#file-system-access-api"})]})})]})})}const c=(await i((async()=>{const{default:e}=await import("./sweetalert2.esm.all-BZxvatOx.js");return{default:e}}),[],import.meta.url)).default;let f;if(!e&&!ge&&(f=await c.fire({icon:"question",title:U({en:"Download",vi:"Tải xuống"})+"?",text:S,showDenyButton:!0,showCancelButton:!1,confirmButtonColor:"#d33",denyButtonColor:"#1668dc",confirmButtonText:U({en:"Download from cursor",vi:"Tải từ vị trí"}),denyButtonText:U({en:"Download all",vi:"Tải từ đầu"})}),f.isDismissed))return;if(null==f?void 0:f.isConfirmed){const n=await c.fire({icon:"info",title:U({en:"Download from cursor",vi:"Tải từ vị trí"}),html:`\n                <label for="from-cursor">\n                ${U({en:"Last cursor",vi:"Con trỏ cuối"})}: (${U({en:"leave empty to re-download all",vi:"bỏ trống để tải từ đầu"})})\n                </label><br/>\n                <input\n                    id="from-cursor"\n                    class="swal2-input"\n                    style="margin: 5px"\n                    value="${e||localStorage.getItem(S+"_fromCursor")||""}">\n                <br/>\n                <label for="start-index">\n                ${U({en:"Last index",vi:"Vị trí cuối"})}: (${U({en:"for auto generate file name",vi:"để tự động tạo tên file"})})\n                </label><br/>\n                <input\n                    id="start-index"\n                    class="swal2-input"\n                    style="margin: 5px"\n                    value="${a||localStorage.getItem(S+"_startIndex")||0}">\n            `,preConfirm:()=>{var e,n;return[null==(e=document.getElementById("from-cursor"))?void 0:e.value,null==(n=document.getElementById("start-index"))?void 0:n.value]},showCancelButton:!0,confirmButtonText:U({en:"Start download",vi:"Bắt đầu tải"})});if(n.isDismissed||n.isDenied)return;e=n.value[0],a=parseInt((null==(d=n.value)?void 0:d[1])||0)}if(!r){const e=await c.fire({icon:"question",title:U({en:"Data type",vi:"Loại dữ liệu"}),html:`\n                    <label for="download-type">\n                        ${U({en:"Which data type you want to download?",vi:"Bạn muốn tải xuống loại dữ liệu nào?"})}\n                    </label><br/>\n                    <select\n                        id="download-type"\n                        class="swal2-select"\n                        style="margin: 5px">\n                        ${Object.values(P).map((e=>`<option value="${e}">${e}</option>`)).join("")}\n                    </select>\n                `,preConfirm:()=>{var e;return null==(e=document.getElementById("download-type"))?void 0:e.value},showCancelButton:!0,reverseButtons:!0});if(e.isDismissed)return;r=e.value}const g=(await i((async()=>{const{checkVIP:e}=await import("./useVIP-CGpIDALh.js");return{checkVIP:e}}),__vite__mapDeps([4,2,3,5,1,6,7,8,9,10,11,12]),import.meta.url)).checkVIP;if(!(await g()))return;let x;if(h("downloadCollection:"+r+":"+(ge?`selected:${me.length}:`:"all:")+S),"file"===r){const e=await window.showDirectoryPicker({mode:"readwrite"});await e.requestPermission({writable:!0}),x=await e.getDirectoryHandle(p(S),{create:!0})}const j=await o(),w="downloading_collection_"+S,y="stopping_downloading_collection_"+S;Z.loading({key:w,content:U({en:"Downloading",vi:"Đang tải"})+"...",duration:0});const b=e?[]:ge?[...me]:[...re];let k=0,C=0,D=0,T=0,I=0,$=!0,B=!1,O=!1,M=!0,V=[],R=[];for(;!B&&M;){if(!ge&&I>=b.length-F){const n=await(null==N?void 0:N(b,$?e:void 0)),t=u(b,n,E);!(null==t?void 0:t.length)&&$&&e&&ee.open({type:"error",message:U({en:"No data at from your cursor",vi:"Không có dữ liệu tại vị trí bạn nhập"})+e+" ("+S+")",description:U({en:"Will download from start",vi:"Sẽ tải từ đầu"}),duration:0}),$=!1,console.log(t),(null==t?void 0:t.length)?b.push(...t):M=!1}const t=b.slice(I,I+F);if(!t.length)break;const i=Math.min(F,t.length),o=Array.from({length:i},(()=>""));await Promise.all(t.map((async(e,t)=>{try{let s="json"===r?[{url:"json",name:"json"}]:await L(e,k,r);s||(s=[]),Array.isArray(s)||(s=[s]);let d=!1;for(let e=0;e<s.length&&!B;e++){const{url:c,name:h}=s[e];if(!c)continue;const u=a+I+t+"_"+e+"_"+h;if(s[e].name=u,o[t]="thread "+(t+1)+": item "+(k+t+1)+(s.length>1?` (${e+1}/${s.length})`:""),B||O||Z.loading({key:w,content:n.jsxs("span",{children:[`${U({en:"Downloading",vi:"Đang tải"})}... ${C}`,D?n.jsxs(n.Fragment,{children:[U({en:"Failed",vi:"Lỗi"}),": $",D," ",n.jsx("br",{})]}):"",n.jsx("br",{}),S,n.jsx("br",{}),n.jsx("i",{children:U({en:"Click to stop",vi:"Bấm để dừng"})}),n.jsx("br",{}),n.jsx(_,{}),o.map(((e,t)=>n.jsxs("span",{style:{width:"100%",textAlign:"left",display:"block"},children:[e,n.jsx("br",{})]},t))),n.jsx("br",{})]}),duration:0,onClick:()=>{B=!0,Z.loading({key:y,content:U({en:"Stopping...",vi:"Đang dừng..."}),duration:0})}}),R.push(c),"file"===r)try{const e=await v({url:c,checkAbortFn:()=>B}),n=await e.blob(),t=await x.getFileHandle(u,{create:!0}),i=await t.createWritable();await i.write(n),await i.close()}catch(i){console.log(i),B||(j?(await l({url:c,conflictAction:"overwrite",filename:S+"/"+u}),d=!0):(D++,ee.open({type:"error",message:U({en:"Download failed",vi:"Lỗi tải"}),description:c})))}C++}d&&T++,k++,V.push(e),pe((n=>({...n,[E(e)]:!0}))),fe((n=>n.filter((n=>E(n)!==E(e)))))}catch(i){D++,Z.error({content:U({en:"Download failed",vi:"Lỗi tải"})+": "+i.message})}}))),B||(I+=t.length)}if(O=!0,"json"===r||"link"===r){const e=S+("json"===r?".json":".txt"),n="json"===r?JSON.stringify(V,null,4):R.join("\n");i((()=>import("./file-download-pLw6ZM0z.js").then((e=>e.f))),__vite__mapDeps([13,2,3]),import.meta.url).then((t=>{t.default(n,e)}))}let q="";try{q=(null==A?void 0:A(b[I]||b[I-1]))||""}catch(z){console.error(z)}Z.destroy(w),Z.destroy(y),T>0&&ee.open({type:"info",message:U({en:"In Download/ folder",vi:"Trong folder Download/"})+": "+T,description:U({en:"Files that cannot be normal downloaded, will be force download into default Download folder of your browser",vi:"Những file không thể tải bình thường, sẽ được tải vào trong folder Download/ mặc định của trình duyệt"}),duration:0,btn:n.jsx(t,{onClick:s,children:U({en:"Show Download/ folder",vi:"Mở folder Download/"})})}),ee.open({type:"success",message:U(B?{en:"Download stopped",vi:"Đã dừng tải"}:{en:"Download finished",vi:"Tải xong"}),description:n.jsxs("ul",{children:[n.jsx("li",{children:U({en:"Folder name",vi:"Tên folder"})+": "+S}),n.jsx("li",{children:U({en:"Downloaded",vi:"Đã tải"})+": "+C}),T>0&&n.jsx("li",{children:U({en:"In Download/ folder",vi:"Trong folder Download/"})+": "+T}),n.jsx("li",{children:U({en:"Last index",vi:"Vị trí cuối"})+": "+(I+a)}),n.jsx("li",{children:U({en:"Last cursor",vi:"Con trỏ cuối"})+": "+q})]}),duration:0,btn:n.jsx(m,{direction:"horizontal",children:B&&!ge?n.jsx(t,{onClick:()=>De({downloadType:r,fromCursor:q,startIndex:I+a}),children:U({en:"Continue download",vi:"Tiếp tục tải"})}):null})}),localStorage.setItem(S+"_fromCursor",q+""),localStorage.setItem(S+"_startIndex",I+a+"")},Te=ge&&(null==me?void 0:me.length)>0?me:re,Ie=ge&&me.length?me.length:U({en:"all",vi:"tất cả"}),$e=ge&&me.length?n.jsx(f.Text,{type:"secondary",children:U({en:`Download ${Ie} selected items`,vi:`Tải ${Ie} mục đang chọn`})}):n.jsx(f.Text,{type:"secondary",children:U({en:"Auto load more until nothing left",vi:"Tự động tải thêm cho đến khi không còn"})}),_e={items:[{key:"selectMode",label:n.jsxs(m,{align:"center",children:[n.jsxs(k,{placement:"left",title:U({en:"Select mode",vi:"Chọn để tải"}),content:U({en:n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsxs(g,{color:"success",children:[n.jsx("i",{className:"fa-solid fa-check"})," ON"]}),"Download only selected items"]}),n.jsxs("li",{children:[n.jsxs(g,{color:"warning",children:[n.jsx("i",{className:"fa-solid fa-xmark"})," OFF"]}),"Download all items (auto load more)"]}),n.jsxs("li",{children:["Shortcut:"," ",n.jsx(g,{style:{borderRadius:"9999px"},children:"Shift"})]})]}),vi:n.jsxs("ul",{children:[n.jsxs("li",{children:[n.jsxs(g,{color:"success",children:[n.jsx("i",{className:"fa-solid fa-check"})," BẬT"]}),"Chỉ tải những mục đã chọn"]}),n.jsxs("li",{children:[n.jsxs(g,{color:"warning",children:[n.jsx("i",{className:"fa-solid fa-xmark"})," TẮT"]}),"Tải tất cả (tự động tải thêm)"]}),n.jsxs("li",{children:["Phím tắt:"," ",n.jsx(g,{style:{borderRadius:"9999px"},children:"Shift"})]})]})}),children:[n.jsx(C,{checked:ge})," ",U({en:"Select mode",vi:"Chọn để tải"})]}),n.jsxs(m.Compact,{children:[me.length!==re.length&&n.jsx(x,{title:U({en:"Select all",vi:"Chọn tất cả"}),children:n.jsx(t,{onClick:e=>{e.preventDefault(),e.stopPropagation(),fe(re),xe(!0)},icon:n.jsx("i",{className:"fa-solid fa-check"}),children:re.length})}),(null==me?void 0:me.length)>0&&n.jsx(x,{title:U({en:"Clear selected",vi:"Bỏ chọn"}),children:n.jsx(t,{onClick:e=>{e.preventDefault(),e.stopPropagation(),fe([])},icon:n.jsx("i",{className:"fa-solid fa-trash"}),children:null==me?void 0:me.length})})]})]})},{type:"divider"},{key:"file",label:n.jsxs(m,{direction:"vertical",children:[n.jsx(f.Text,{strong:!0,children:"📁 "+U({en:`Download ${Ie} files (photo/video)`,vi:`Tải ${Ie} files (ảnh/video)`})}),$e]})},{key:"link",label:n.jsxs(m,{direction:"vertical",children:[n.jsx(f.Text,{strong:!0,children:"🔗 "+U({en:`Export ${Ie} links`,vi:`Xuất ${Ie} links`})}),$e]})},{key:"json",label:n.jsxs(m,{direction:"vertical",children:[n.jsx(f.Text,{strong:!0,children:"📄 "+U({en:`Export ${Ie} to .json`,vi:`Xuất ${Ie} ra .json`})}),$e]})},{type:"divider"},...M.map((({key:e,label:n,labelFn:t})=>({key:e,label:(null==t?void 0:t(Te))||n})))],onClick:e=>{var n;if(M.length&&M.some((n=>n.key===e.key))){const t=null==(n=M.find((n=>n.key===e.key)))?void 0:n.onClick;t&&t(Te,ae)}else"selectMode"===e.key?xe(!ge):!ge||(null==me?void 0:me.length)>0?De({downloadType:e.key}):Z.info(U({en:"Please select media to download",vi:"Vui lòng chọn ảnh/video muốn tải"}))}};return n.jsxs(m,{direction:"vertical",align:"center",style:{width:"100%"},className:Y?"collection-center":"",children:[null==q?void 0:q(re),n.jsxs(m.Compact,{style:{justifyContent:"center"},children:[N&&n.jsx(t,{onClick:()=>ye(!0),icon:n.jsx("i",{className:"fa-solid fa-rotate-right"}),disabled:ie,loading:ie,children:U(ie?{en:"Loading..",vi:"Đang tải.."}:{en:"Refresh",vi:"Làm mới"})}),L&&n.jsx(D,{disabled:!re.length,menu:_e,placement:"bottomCenter",children:n.jsx(t,{type:"primary",icon:n.jsx("i",{className:"fa-solid fa-download"}),children:ge?me.length?U({en:"Download",vi:"Tải xuống"})+` (${me.length})`:U({en:"Select to download...",vi:"Chọn để tải..."}):U({en:"Download all",vi:"Tải xuống"})})}),null==R?void 0:R(re,ie)]}),Q&&n.jsx(T.Search,{value:he,onChange:e=>ue(e.target.value+""),placeholder:U(X(re)),allowClear:!0,style:{minWidth:300}}),n.jsx(I,{grid:{gutter:10,column:"vertical"===V?1:void 0},pagination:!!W&&{showTotal:(e,n)=>U({en:`Showing ${n[0]}-${n[1]} / Total ${e}`,vi:`Hiển thị ${n[0]}-${n[1]} / Tổng ${e}`}),defaultPageSize:J,showSizeChanger:!0,position:"bottom",align:"center"},dataSource:ve,renderItem:Ce,rowKey:E,loadMore:W||G?null:n.jsx($,{justify:"center",children:n.jsxs(m,{direction:"vertical",align:"center",children:[n.jsxs(g,{color:"success",children:[U({en:"Total",vi:"Tổng"}),": ",re.length]}),we&&!W?n.jsx("div",{style:{height:500},children:n.jsx(j,{tip:U({en:"Loading",vi:"Đang tải"}),children:n.jsx("div",{style:{padding:50,background:"rgba(0, 0, 0, 0.05)",borderRadius:4}})})}):n.jsx(x,{placement:"bottom",title:U({en:n.jsxs(n.Fragment,{children:["🤔 If FB AIO does not load more automatically",n.jsx("br",{}),"👀 But you think there are more data",n.jsx("br",{}),"👆 Please click this button"]}),vi:n.jsxs(n.Fragment,{children:["🤔 Nếu FB AIO không tự động tải thêm nữa",n.jsx("br",{}),"👀 Nhưng bạn tin vẫn còn dữ liệu",n.jsx("br",{}),"👆 Hãy bấm nút này"]})}),mouseEnterDelay:.5,children:n.jsx(t,{icon:n.jsx("i",{className:"fa-solid fa-play"}),onClick:()=>ke(),loading:ie,children:U({en:"Load more",vi:"Tải thêm"})})})]})})})]})}export{S as DisplayType,P as DownloadType,B as default};
