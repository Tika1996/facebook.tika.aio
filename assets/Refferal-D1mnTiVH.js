const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./copy-Ddr5DXUq.js","./index-DZEcYG8Q.js","./index-C6k8ZUm0.css","./useVIP-CGpIDALh.js","./MyApp-DRRa55Bd.js","./sweetalert2.esm.all-BZxvatOx.js","./getIds-BE6G2xp0.js","./index-B87p3I4c.js","./Input-LTpJ6AuY.js","./EyeOutlined-BBPXKIU8.js","./SearchOutlined-Bh66KhXc.js","./index-CiDxWY8X.js","./Dropdown-BgvXKd3u.js","./MySwal-DffQNiol.js"])))=>i.map(i=>d[i]);
import{r as e,aX as n,b1 as t,b5 as r,aY as i,bg as s,a_ as a}from"./index-DZEcYG8Q.js";import{u as o,W as c,x as l,j as d,aT as h,c as u,T as m,t as p,ah as f,S as g,b as j,f as x}from"./MyApp-DRRa55Bd.js";import v from"./useCacheState-D4ghBCVU.js";import{A as y}from"./index-DhxhS065.js";import{I as b}from"./index-B87p3I4c.js";import"./useBreakpoint-HjQEkdEA.js";import"./index-C0Edlh-n.js";import"./Input-LTpJ6AuY.js";import"./EyeOutlined-BBPXKIU8.js";import"./SearchOutlined-Bh66KhXc.js";function I(){const{ti:I}=o(),[C,V]=v("Referral.friends",[]),[_,S]=v("Referral.friendsProfiles",new Map),[k,E]=e.useState(!1),[T,M]=v("Referral.entered",null),[N,R]=v("Referral.enteredProfile",null),[O,A]=v("Referral.myRefCode",""),[F,B]=e.useState(!1),[z,D]=e.useState(""),[K,L]=e.useState(""),[W,Y]=e.useState(!1);e.useEffect((()=>{c().then((async e=>{A(w(e));const t=await n(a.FB_AIO.server+"/check-referral?uid="+e),r=l(t||"{}");console.log("check",r);const{friends:i=[],entered:s=null}=r;if(V(i),M(s),null==s?void 0:s.uid){const e=await d(null==s?void 0:s.uid);R(e)}}))}),[]);const $=e.useRef(!1),J=e.useRef(!1);e.useEffect((()=>{F&&C.length&&!$.current&&!J.current&&($.current=!0,(async()=>{E(!0);const e=new Map,n=C.map(((n,t)=>async()=>{try{const t=await d(null==n?void 0:n.uid);return e.set(null==n?void 0:n.uid,t),S(new Map(e)),t}catch(t){return console.error(t),null}}));await h(5,n).start(),E(!1),$.current=!1,J.current=!0})())}),[F,C]),e.useEffect((()=>{L("")}),[z]);return t.jsxs(t.Fragment,{children:[t.jsx("h4",{children:I({en:t.jsxs(t.Fragment,{children:["Share code to your friend, both get"," ",t.jsx("b",{className:"highlight",children:"3 days VIP"})]}),vi:t.jsxs(t.Fragment,{children:["Rủ bạn bè nhập mã, cả 2 nhận ",t.jsx("b",{className:"highlight",children:"3 ngày VIP"})]})})}),t.jsx("hr",{}),t.jsxs("div",{className:"vip-option","data-option":I({en:"Share (unlimited)",vi:"Chia sẻ (vô hạn)"}),children:[t.jsxs(u.Text,{children:[I({en:"Your code",vi:"Mã của bạn"}),t.jsxs("b",{className:"highlight",style:{display:"block"},children:[O,t.jsx(m,{title:I({en:"Copy",vi:"Sao chép"}),children:t.jsx(r,{size:"small",type:"text",onClick:async()=>{p("VIP:copyRefCode");const{copyWithMessage:e}=await i((async()=>{const{copyWithMessage:e}=await import("./copy-Ddr5DXUq.js");return{copyWithMessage:e}}),__vite__mapDeps([0,1,2]),import.meta.url);e(O)},children:t.jsx("i",{className:"fa-regular fa-copy fa-lg"})})})]})]}),t.jsx("div",{style:{marginTop:10},children:C.length?t.jsx(s,{expandIconPosition:"end",size:"small",onChange:e=>B(e.length>0),activeKey:F?"1":void 0,children:t.jsx(s.Panel,{header:I({en:t.jsxs(u.Text,{children:["✅ ",C.length," friends enter your code",t.jsx("br",{}),"👑 added ",3*C.length," days VIP"]}),vi:t.jsxs(u.Text,{children:["✅ ",C.length," bạn bè đã nhập mã của bạn",t.jsx("br",{})," 👑 tặng ",3*C.length," ngày VIP"]})}),children:t.jsxs("div",{children:[k&&t.jsx(f,{}),t.jsx(g,{direction:"vertical",align:"start",children:C.map((e=>{var n,r;return t.jsxs(g,{size:0,children:[t.jsx(j,{children:x(e.time)}),t.jsx(y,{src:null==(n=_.get(e.uid))?void 0:n.avatar,size:30}),t.jsx(u.Link,{href:`https://www.facebook.com/${e.uid}`,target:"_blank",children:(null==(r=_.get(e.uid))?void 0:r.name)||e.uid})]},e.uid)}))})]})},"1")}):I({en:t.jsxs(t.Fragment,{children:["❓ No friends enter your code",t.jsx("br",{}),"Copy and Share now 🚀"]}),vi:t.jsxs(t.Fragment,{children:["❓ Chưa có ai nhập mã của bạn",t.jsx("br",{}),"Sao chép và Chia sẻ ngay 🚀"]})})})]}),t.jsx("hr",{}),t.jsx("div",{className:"vip-option","data-option":I({en:"Enter code (once)",vi:"Nhập mã (1 lần)"}),children:t.jsxs(g,{direction:"vertical",children:[t.jsxs(u.Text,{children:["🎁"," ",I({en:"Enter your friend's referral code",vi:"Nhập mã giới thiệu của bạn bè"})]}),t.jsx(b,{size:"large",value:z,onChange:e=>D(e.target.value),placeholder:I({en:"Friend referral code",vi:"Mã giới thiệu của bạn bè"}),allowClear:!0}),!!K&&t.jsxs(u.Text,{type:"danger",children:["❗",K]}),t.jsx(r,{type:"primary",icon:t.jsx("i",{className:"fa-solid fa-search"}),onClick:async()=>{var e;function t(e){L(e),Y(!1)}L(""),Y(!0);const r=z;if(!r)return t(I({en:"Please enter referral code",vi:"Vui lòng nhập mã"}));const s=P(r);if(!s)return p("VIP:enterInvalidCode"),t(I({en:"Invalid code (wrong uid)",vi:"Mã không hợp lệ (sai uid)"}));const o=await c();if(s===o)return p("VIP:enterYourOwnCode"),t(I({en:"Cannot use your own code",vi:"Không thể dùng mã của chính bạn"}));const h="uidOnThisDevice",u=[];try{const n=(null==(e=localStorage.getItem(h))?void 0:e.split(","))||[];u.push(...n),n.includes(o)||(n.push(o),localStorage.setItem(h,n.join(",")))}catch(x){console.error(x)}if(u.includes(s))return p("VIP:enterSameDeviceAccountCode"),t(I({en:"Cannot use code from accounts on same device. Please use another code (from your friends)",vi:"Không thể dùng mã từ các tài khoản trên cùng 1 máy. Vui lòng nhập mã khác (từ bạn bè)"}));try{if(!(await d(s)))throw new Error}catch(x){return p("VIP:enterInvalidCodeAboutNotFound"),t(I({en:"Invalid code (cannot find code owner infor)",vi:"Mã không hợp lệ (không tìm được thông tin chủ nhân của mã)"}))}const m=await n(a.FB_AIO.server+"/referral",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:o,referralCode:r})});console.log(m);const f=l(m);if(null==f?void 0:f.error)return t(I(f.error));Y(!1),p("VIP:enterCodeSuccess");const{isBEVIP:g}=await i((async()=>{const{isBEVIP:e}=await import("./useVIP-CGpIDALh.js");return{isBEVIP:e}}),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11,12]),import.meta.url);g(!0);const j=(await i((async()=>{const{default:e}=await import("./MySwal-DffQNiol.js");return{default:e}}),__vite__mapDeps([13,5,1,2]),import.meta.url)).default;await j.fire({icon:"success",title:I({en:"Code entered successfully",vi:"Nhập mã thành công"}),text:I({en:"3 days VIP has been added to your account",vi:"3 ngày VIP đã được thêm vào tài khoản của bạn"}),confirmButtonText:I({en:"Awesome!",vi:"Tuyêt vời!"})})},loading:W,children:I({en:"Check ✨",vi:"Kiểm tra ✨"})})]})})]})}function w(e){const n=e.split("").map((e=>parseInt(e))),t=n.reduce(((e,n)=>e+n),0),r=Math.max(...n);return btoa(t*r+"")+"_"+e}function P(e){try{if(!e)return!1;const[n,t]=e.trim().split("_");return e===w(t)&&t}catch(n){return!1}}export{P as checkReferralCode,I as default,w as genReferralCodeFromUID};
